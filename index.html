<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="theme-color" content="#1a1a1a">

    <link rel="manifest" href="manifest.json">

    <script src="suncalc.js"></script>

    <title>Kompletne Centrum Informacyjne</title>

    <style>
        /* ==========================================================================
           KONFIGURACJA PRƒòDKO≈öCI SCROLLOWANIA
           ========================================================================== */
        :root {
            --kolor-aktywny: #00FF00;
            --kolor-tla: #1a1a1a;
            --kolor-ramki: #000;
            --kolor-sentencji: #d461ff;

            /* Prƒôdko≈õci przesuwania tekstu - im wiƒôksza liczba, tym wolniej */
            --speed-sentencja: 30s; 
            --speed-swieto: 30s;
            --speed-imieniny: 30s;
        }

        html, body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: var(--kolor-tla);
            font-family: 'Courier New', Courier, monospace;
            color: var(--kolor-aktywny);
            padding: 0;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        #kontener {
            width: 1000px;
            padding: 20px 30px;
            border: 4px solid var(--kolor-aktywny);
            border-radius: 10px;
            background-color: var(--kolor-ramki);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-sizing: border-box;
            transform-origin: top center;
            transition: transform 0.2s ease-out;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        #tabela-naglowek {
            width: 100%;
            border-collapse: collapse;
        }
        #tabela-naglowek td {
            padding: 10px;
            border: none;
            vertical-align: middle;
        }

        .komorka-dzien {
            font-size: clamp(1.8rem, 4vw, 3rem); 
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 5px var(--kolor-aktywny);
            width: auto;
            text-align: center;
            vertical-align: top; 
            padding-top: 0; 
            padding-right: 20px;
            white-space: nowrap;
        }

        /* ==========================================================================
           STYLE DLA P≈ÅYNNEGO SCROLLOWANIA (SEAMLESS LOOP)
           ========================================================================== */
        
        /* 1. G≈Ç√≥wne okno maskujƒÖce (przycinanie i gradient) */
        .scroller-wrap {
            display: inline-block;
            vertical-align: bottom;
            overflow: hidden;
            position: relative;
            white-space: nowrap;
            mask-image: linear-gradient(to right, transparent 0%, black 10%, black 90%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 10%, black 90%, transparent 100%);
        }

        /* 2. Szyna (track) trzymajƒÖca dwie kopie tekstu */
        .scroller-track {
            display: flex;
            width: max-content; 
            animation: scroll-seamless var(--anim-speed) linear infinite;
        }

        /* Klasa dla zatrzymanego scrolla */
        .scroller-track.stopped {
            animation: none !important;
            width: 100%;
            justify-content: center;
            transform: translateX(0) !important;
        }

        /* 3. Pojedynczy element tekstu wewnƒÖtrz szyny - baza */
        .scroller-content {
            white-space: nowrap;
            display: inline-block;
        }

        /* --- INDYWIDUALNE ODSTƒòPY (padding-right) DLA AKTYWNEJ ANIMACJI --- */
        
        /* Sentencja - gdy siƒô rusza */
        #sentencja-track .scroller-content {
            padding-right: 100px; 
        }

        /* ≈öwiƒôto - gdy siƒô rusza */
        #swieto-track .scroller-content {
            padding-right: 100px;
        }

        /* Imieniny - gdy siƒô rusza */
        #imiona-track .scroller-content {
            padding-right: 100px;
        }

        /* --- ODSTƒòP DLA ZATRZYMANEJ ANIMACJI (Dla wszystkich taki sam) --- */
        .scroller-track.stopped .scroller-content {
            padding-right: 50px !important;
        }

        /* Kluczowa animacja pƒôtli */
        @keyframes scroll-seamless {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* --- Specyficzne ustawienia dla SENTENCJI --- */
        #sentencja-kontener {
            max-width: 360px; 
            margin: 0 auto; 
            display: block; 
            margin-bottom: 10px;
        }
        
        #sentencja-track .scroller-content {
            color: var(--kolor-sentencji);
            font-size: 1.2rem;
            font-weight: bold;
            font-style: italic;
            text-shadow: 0 0 3px var(--kolor-sentencji);
            letter-spacing: 1px;
            text-transform: none; 
        }

        /* --- Specyficzne ustawienia dla ≈öWIƒòTA i IMIENIN (w tabeli) --- */
        .tabela-scroller {
            max-width: 350px; 
            vertical-align: middle;
            margin-bottom: -4px; 
        }

        /* ========================================================================== */

        .komorka-lokalizacja-pogoda {
            text-align: left;
            vertical-align: middle;
            border-left: 1px dotted #008000;
            padding-left: 15px;
            width: 55%;
        }

        .komorka-menu {
            width: 50px;
            vertical-align: top;
            text-align: right;
            position: relative;
        }
        
        #lokalizacja {
            font-size: 1.3rem;
            color: #00c000;
            font-weight: bold;
            min-height: 1.5rem;
            display: flex;
            align-items: center; 
        }
        #lokalizacja-ikona {
            font-size: 1.1rem;
            margin-right: 8px;
            color: var(--kolor-aktywny);
        }
        
        #wspolrzedne {
            font-size: 0.9rem;
            color: #87CEEB;
            margin-top: 4px;
            min-height: 1rem;
            display: flex;
            align-items: center;
            white-space: nowrap;
        }
        #wspolrzedne-ikona {
            margin-right: 8px;
            font-size: 1.5rem;
        }
        
		#wiatr-ikona {
			font-size: 1.5rem;
		}
        #wiatr-wskaznik {
            display: inline-block; 
            font-size: 2rem;
			padding-bottom: 6px;
            margin-right: 5px;
            transition: transform 1s ease-out;
            color: #FFA500;
        }
        #wiatr-info {
            font-size: 1.2rem;
            color: #FFA500;
            font-weight: bold;
        }

        .separator-maly {
            display: inline-block;
            width: 1px;
            height: 1.2rem;
            background-color: #4682B4; 
            margin: 0 10px;
            opacity: 0.6;
        }
        
        #pogoda {
            font-size: 1.2rem;
            color: var(--kolor-aktywny);
            display: flex;
            align-items: center;
            margin-top: 5px;
            white-space: nowrap; 
        }
        #pogoda-ikona {
            font-size: 1.8rem;
            margin-right: 10px;
        }
        #pogoda-info {
            line-height: 1.4;
        }

        .dane-separator {
            display: inline-block;
            width: 1px;
            height: 1.2rem;
            background-color: #004400; 
            margin: 0 15px; 
        }

        #cisnienie-ikona {
            font-size: 1.4rem;
            margin-right: 5px;
        }

        #cisnienie-info {
            color: #00c000;
            margin-right: 5px;
        }
        
        #cisnienie-trend {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .trend-wzrost { color: #00FF00; } 
        .trend-spadek { color: #FF4500; } 
        .trend-stale { color: #888888; }  

        .menu-kontener {
            position: relative;
            display: inline-block;
        }

        .menu-przycisk {
            background-color: transparent;
            color: var(--kolor-aktywny);
            font-size: 2.5rem;
            border: none;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            text-shadow: 0 0 5px var(--kolor-aktywny);
        }

        .menu-przycisk:hover, .menu-przycisk:focus {
            color: #ccffcc;
            outline: none;
        }

        .menu-tresc {
            display: none;
            position: absolute;
            right: 0;
            top: 40px;
            background-color: darkgreen;
            min-width: 250px;
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.8);
            border: 2px solid var(--kolor-aktywny);
            border-radius: 5px;
            z-index: 1000;
            text-align: left;
        }

        .menu-tresc a {
            color: var(--kolor-aktywny);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            font-size: 1rem;
            border-bottom: 1px dotted #00ff00;
        }

        .menu-tresc a:last-child {
            border-bottom: none;
        }

        .menu-tresc a:hover {
            background-color: #003300;
            color: #ffffff;
        }

        .menu-tresc.pokaz {
            display: block;
        }

        #tabela-info-roczne {
            width: auto; 
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #00c000;
        }
        #tabela-info-roczne td {
            padding: 3px 0;
            border: none;
            vertical-align: middle;
        }
        #tabela-info-roczne .max {
            color: #008000;
        }
        /* Style dla tekst√≥w wewnƒÖtrz scrolla (≈öwiƒôto/Imieniny) */
        #swieto-track .scroller-content,
        #imiona-track .scroller-content {
            color: var(--kolor-aktywny);
            font-weight: bold;
        }
        
        #tabela-info-roczne td:nth-child(1) {
            text-align: right;
            padding-right: 10px;
            white-space: nowrap;
        }
        #tabela-info-roczne td:nth-child(2) {
            text-align: right; 
            padding-right: 10px;
            padding-left: 10px;
            border-left: 1px dotted #008000;
            white-space: nowrap;
        }
        #tabela-info-roczne td:nth-child(3) {
            text-align: left;
            padding-left: 10px;
            border-left: 1px dotted #008000;
            line-height: 1.4;
            display: flex; 
            align-items: center;
        }

        #zegar-segmentowy-kontener {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 10px;
            width: 100%;
        }
        .kontener-linii {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: nowrap;
            white-space: nowrap;
        }

        .cyfra {
            position: relative;
            width: 30px;
            height: 50px;
            margin: 0 5px;
            flex-shrink: 0;
        }

        .segment {
            position: absolute;
            background-color: var(--kolor-aktywny);
            opacity: 0.1;
            transition: opacity 0.2s;
            border-radius: 2px;
            box-shadow: 0 0 5px var(--kolor-aktywny);
        }
        .segment.active { opacity: 1; }
        
        .segment.a, .segment.d, .segment.g { width: 20px; height: 4px; left: 5px; }
        .segment.b, .segment.c, .segment.e, .segment.f { width: 4px; height: 20px; }
        .segment.a { top: 0; }
        .segment.d { top: 46px; }
        .segment.g { top: 23px; }
        .segment.b { top: 5px; left: 26px; }
        .segment.c { top: 25px; left: 26px; }
        .segment.f { top: 5px; left: 0; }
        .segment.e { top: 25px; left: 0; }

        .separator {
            height: 50px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }
        
        .separator-dwukropek { width: 20px; }
        .separator-dwukropek::before,
        .separator-dwukropek::after {
            content: '';
            display: block;
            width: 4px;
            height: 4px;
            background-color: var(--kolor-aktywny);
            border-radius: 50%;
            box-shadow: 0 0 5px var(--kolor-aktywny);
            transition: opacity 0.1s;
        }
        .separator-dwukropek::before { margin-bottom: 8px; margin-top: 8px; }
        .separator-dwukropek.wygaszony::before,
        .separator-dwukropek.wygaszony::after { opacity: 0.1; }

        .separator-kreska { width: 30px; display: flex; justify-content: center; align-items: center; }
        .separator-kreska::before {
            content: '';
            display: block;
            width: 20px;
            height: 4px;
            background-color: var(--kolor-aktywny);
            box-shadow: 0 0 5px var(--kolor-aktywny);
            border-radius: 2px;
        }

        .separator-spacer { width: 25px; height: 50px; flex-shrink: 0; }

        #tabela-slonce {
            width: auto; 
            border-collapse: collapse;
        }
        #tabela-slonce td {
            padding: 4px 8px;
            border: none;
            text-align: left;
            font-size: 1.3rem;
            color: #00c000;
            vertical-align: top;
            align-items: center;
            white-space: nowrap;
        }

        .etykieta-aktywna {
            color: var(--kolor-aktywny);
            font-weight: bold;
        }
        .etykieta-nieaktywna {
            color: #004400;
            font-weight: normal;
        }
        
        #tabela-slonce #odliczanie-slonca {
            font-size: 1.3rem;
            color: #ffff00;
            text-shadow: 0 0 5px #ffff00;
            font-weight: normal;
            display: flex;
            align-items: center;
        }
        
        .ikona-tabeli {
            margin-right: 8px;
            font-size: 1.1rem;
            color: var(--kolor-aktywny);
        }
        #odliczanie-ikona {
            margin-right: 8px;
            font-size: 1.1rem;
            color: #ffff00;
        }

        #tabela-astro {
            width: 100%;
            border-collapse: collapse;
        }
        .astro-komorka {
            vertical-align: top;
            padding: 4px 8px;
            font-size: 1.2rem; 
            color: #00c000;
            white-space: nowrap;
        }
        
        #tabela-astro tr td:first-child {
            text-align: right;
            border-right: 1px dotted #008000;
            padding-right: 15px;
        }
        #tabela-astro tr td:last-child {
            text-align: left;
            padding-left: 15px;
        }

        .astro-item {
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        #tabela-astro tr:nth-child(1) .astro-komorka:last-child .astro-item {
             justify-content: flex-start;
        }
        
        .astro-item span { color: var(--kolor-aktywny); }
        .zodiak-emoji, #faza-ksiezyca-obraz {
            font-size: 2.5rem;
            margin-right: 10px;
            text-shadow: none;
            width: 40px;
            text-align: center;
        }
        
        .astro-countdown-komorka {
            font-size: 1.2rem;
            color: #00C000;
            padding-top: 5px;
        }
        .astro-countdown-komorka span {
            color: var(--kolor-aktywny);
            font-weight: bold;
        }
        .astro-separator-maly {
            margin: 0 10px;
            font-size: 1.1rem;
            color: #008000;
        }

        #obroc-urzadzenie {
            display: none;
            position: fixed; 
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--kolor-ramki);
            color: var(--kolor-aktywny);
            z-index: 9999; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 1.5rem;
        }

        #obroc-urzadzenie .ikona {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: obrot-ikony 2s linear infinite;
        }

        @keyframes obrot-ikony {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @media (orientation: portrait) {
            #kontener { display: none; }
            #obroc-urzadzenie { display: flex; }
        }
    </style>
</head>
<body>

    <div id="obroc-urzadzenie">
        <div class="ikona">üì±üîÑ</div>
        <p>Proszƒô obr√≥ciƒá urzƒÖdzenie do pozycji poziomej.</p>
    </div>

    <div id="kontener">

        <table id="tabela-naglowek">
            <tr>
                <td class="komorka-dzien">
                    <div id="dzien">...</div>
                    
                    <div id="sentencja-kontener" class="scroller-wrap" style="--anim-speed: var(--speed-sentencja);">
                        <div id="sentencja-track" class="scroller-track">
                            <span class="scroller-content">Wczytywanie my≈õli...</span>
                            <span class="scroller-content">Wczytywanie my≈õli...</span>
                        </div>
                    </div>

                </td>
                <td class="komorka-lokalizacja-pogoda">
                    <div id="lokalizacja">
                        <span id="lokalizacja-ikona"></span>
                        <span id="lokalizacja-nazwa">Ustalanie lokalizacji...</span>
                    </div>
                    <div id="wspolrzedne">
                        <span id="wspolrzedne-ikona"></span>
                        <span id="wspolrzedne-tekst"></span>
                        <span class="separator-maly"></span>
                        <span id="wiatr-ikona">üí®</span>
                        <span id="wiatr-wskaznik">‚Üì</span>
                        <span id="wiatr-info">...</span>
                    </div>
                    <div id="pogoda">
                        <span id="pogoda-ikona">...</span>
                        <span id="pogoda-info">≈Åadowanie...</span>
                        
                        <span class="dane-separator"></span>
                        
                        <span id="cisnienie-ikona">‚è≤Ô∏è</span>
                        <span id="cisnienie-info">...</span>
                        <span id="cisnienie-trend"></span>
                    </div>
                </td>
                <td class="komorka-menu">
                    <div class="menu-kontener">
                        <button onclick="przelaczMenu()" class="menu-przycisk">‚ò∞</button>
                            <div id="menu-dropdown" class="menu-tresc">
                                <a href="#" onclick="otworzLinkZewnetrzny('https://github.com/TomaszGabara5677/centrum-informacyjne/blob/main/OPIS_FUNKCJI.md'); return false;">Opis funkcji</a>
                                <a href="#" onclick="otworzLinkZewnetrzny('https://github.com/TomaszGabara5677/centrum-informacyjne/blob/main/POLITYKA-PRYWATNOSCI.md'); return false;">Polityka Prywatno≈õci</a>
                                <a href="#" onclick="otworzLinkZewnetrzny('https://github.com/TomaszGabara5677/centrum-informacyjne/blob/main/README.md'); return false;">Informacje og√≥lne</a>
                                <a href="#" onclick="otworzLinkZewnetrzny('https://github.com/TomaszGabara5677/centrum-informacyjne'); return false;">Strona projektu</a>
                                <a href="#" onclick="resetAplikacji(); return false;">Reset Aplikacji</a>
                            </div>
                    </div>
                </td>
            </tr>
        </table>

        <table id="tabela-info-roczne">
            <tr>
                <td>
                    Dzie≈Ñ roku: <span><span id="dzien-roku">...</span><span class="max">/<span id="max-dzien-roku">...</span></span></span>
                </td>
                <td>
                    Tydzie≈Ñ: <span><span id="tydzien-roku">...</span><span class="max">/<span id="max-tydzien-roku">...</span></span></span>
                </td>
                <td>
                    <span>≈öwiƒôto:&nbsp;</span>
                    <div class="scroller-wrap tabela-scroller" style="--anim-speed: var(--speed-swieto);">
                        <div id="swieto-track" class="scroller-track">
                            <span class="scroller-content">...</span>
                            <span class="scroller-content">...</span>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    Do ko≈Ñca roku: <span><span id="dni-do-konca">...</span></span> <span id="dni-do-konca-sufiks">dni</span>
                </td>
                <td>
                    Kwarta≈Ç: <span><span id="kwartal">...</span><span class="max">/4</span></span>
                </td>
                <td>
                    <span>Imieniny:&nbsp;</span>
                    <div class="scroller-wrap tabela-scroller" style="--anim-speed: var(--speed-imieniny);">
                        <div id="imiona-track" class="scroller-track">
                            <span class="scroller-content">...</span>
                            <span class="scroller-content">...</span>
                        </div>
                    </div>
                </td>
            </tr>
        </table>

        <div id="zegar-segmentowy-kontener"></div>

        <table id="tabela-slonce">
            <tr>
                <td>
                    <span class="ikona-tabeli">‚òÄÔ∏è</span>Wsch√≥d <span id="wschod-lbl-dzis">dzi≈õ</span>/<span id="wschod-lbl-jutro">jutro</span>: <span id="wschod" style="font-weight: bold; color: var(--kolor-aktywny);">...</span>
                </td>
                <td>
                    <span class="ikona-tabeli">üï∞Ô∏è</span>D≈Çugo≈õƒá dnia: <span id="czas-dnia" style="font-weight: bold; color: var(--kolor-aktywny);">...</span>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="ikona-tabeli">üåô</span>Zach√≥d <span id="zachod-lbl-dzis">dzi≈õ</span>/<span id="zachod-lbl-jutro">jutro</span>: <span id="zachod" style="font-weight: bold; color: var(--kolor-aktywny);">...</span>
                </td>
                <td id="odliczanie-slonca">
                    <span id="odliczanie-ikona" class="ikona-tabeli"></span>
                    <span id="odliczanie-tekst">≈Åadowanie...</span>
                </td>
            </tr>
        </table>

        <table id="tabela-astro">
            <tr>
                <td class="astro-komorka">
                    <div class="astro-item">
                        <span id="zodiak-obraz" class="zodiak-emoji">...</span>
                        <span>Znak zodiaku: <span id="zodiak-nazwa">...</span></span>
                    </div>
                </td>
                <td class="astro-komorka">
                    <div class="astro-item">
                        <span id="faza-ksiezyca-obraz">...</span>
                        <span>
                            Faza Ksiƒô≈ºyca (<span id="faza-ksiezyca-numer">...</span>/8):
                            <span id="faza-ksiezyca-nazwa">...</span>
                        </span>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="astro-komorka astro-countdown-komorka">
                    Zmiana na: <span id="zodiak-countdown-nazwa">...</span>
                    za: <span id="zodiak-countdown-dni">...</span> <span id="zodiak-countdown-sufiks">dni</span>
                </td>
                <td class="astro-komorka astro-countdown-komorka">
                    Pe≈Çnia za: <span id="pelnia-countdown-dni">...</span> <span id="pelnia-countdown-sufiks">dni</span>
                    <span class="astro-separator-maly">|</span>
                    Zmiana fazy za: <span id="faza-countdown-dni">...</span> <span id="faza-countdown-sufiks">dni</span>
                </td>
            </tr>
            </table>
        
    </div>

    <script src="imieniny.js"></script>
    <script src="swieta.js"></script>

    <script>
        // ================================================================
        // --- SEKCJA KONFIGURACYJNA I STA≈ÅE ---
        // ================================================================
        
        const DNI_TYGODNIA = ['Niedziela', 'Poniedzia≈Çek', 'Wtorek', '≈öroda', 'Czwartek', 'PiƒÖtek', 'Sobota'];
        
        let BIEZACA_LAT = 51.6567; 
        let BIEZACA_LON = 19.3578; 
        let BIEZACA_LOKALIZACJA_NAZWA = "Pabianice, woj. ≈Å√≥dzkie"; 

        const SWIETA_STALE = {
            '01-01': 'Nowy Rok', '01-06': 'Trzech Kr√≥li', '05-01': '≈öwiƒôto Pracy',
            '05-03': '≈öwiƒôto Konstyt. 3 Maja', '08-15': '≈öwiƒôto Wojska Polskiego, Wniebowziƒôcie NMP',
            '11-01': 'Wszystkich ≈öwiƒôtych', '11-11': 'Narodowe ≈öwiƒôto Niepodleg≈Ço≈õci',
            '12-25': 'Bo≈ºe Narodzenie (I dzie≈Ñ)', '12-26': 'Bo≈ºe Narodzenie (II dzie≈Ñ)'
        };

        const ZNAKI_ZODIAKU = [
            { nazwa: 'Kozioro≈ºec', start: [12, 22], emoji: '‚ôë' },
            { nazwa: 'Wodnik', start: [1, 20], emoji: '‚ôí' },
            { nazwa: 'Ryby', start: [2, 19], emoji: '‚ôì' },
            { nazwa: 'Baran', start: [3, 21], emoji: '‚ôà' },
            { nazwa: 'Byk', start: [4, 20], emoji: '‚ôâ' },
            { nazwa: 'Bli≈∫niƒôta', start: [5, 21], emoji: '‚ôä' },
            { nazwa: 'Rak', start: [6, 21], emoji: '‚ôã' },
            { nazwa: 'Lew', start: [7, 23], emoji: '‚ôå' },
            { nazwa: 'Panna', start: [8, 23], emoji: '‚ôç' },
            { nazwa: 'Waga', start: [9, 23], emoji: '‚ôé' },
            { nazwa: 'Skorpion', start: [10, 23], emoji: '‚ôè' },
            { nazwa: 'Strzelec', start: [11, 22], emoji: '‚ôê' }
        ];

        const MAPA_SEGMENTOW = {
            '0': ['a', 'b', 'c', 'd', 'e', 'f'],
            '1': ['b', 'c'],
            '2': ['a', 'b', 'g', 'e', 'd'],
            '3': ['a', 'b', 'g', 'c', 'd'],
            '4': ['f', 'g', 'b', 'c'],
            '5': ['a', 'f', 'g', 'c', 'd'],
            '6': ['a', 'f', 'g', 'e', 'c', 'd'],
            '7': ['a', 'b', 'c'],
            '8': ['a', 'b', 'c', 'd', 'e', 'f', 'g'],
            '9': ['a', 'b', 'c', 'd', 'f', 'g'],
            ' ': [] 
        };

        const STRUKTURA_DATY = [
            { typ: 'cyfra', id: 'data-d1' }, { typ: 'cyfra', id: 'data-d2' },
            { typ: 'separator', 'rodzaj': 'kreska' },
            { typ: 'cyfra', id: 'data-m1' }, { typ: 'cyfra', id: 'data-m2' },
            { typ: 'separator', 'rodzaj': 'kreska' },
            { typ: 'cyfra', id: 'data-r1' }, { typ: 'cyfra', id: 'data-r2' },
            { typ: 'cyfra', id: 'data-r3' }, { typ: 'cyfra', id: 'data-r4' }
        ];
        const STRUKTURA_CZASU = [
            { typ: 'cyfra', id: 'czas-h1' }, { typ: 'cyfra', id: 'czas-h2' },
            { typ: 'separator', 'rodzaj': 'dwukropek' },
            { typ: 'cyfra', id: 'czas-m1' }, { typ: 'cyfra', id: 'czas-m2' },
            { typ: 'separator', 'rodzaj': 'dwukropek' },
            { typ: 'cyfra', id: 'czas-s1' }, { typ: 'cyfra', id: 'czas-s2' }
        ];

        // ================================================================
        // --- ZMIENNE GLOBALNE (CACHE) ---
        // ================================================================
        
        window.ostatniDzien = null;
        window.wschodDzis = null;
        window.zachodDzis = null;
        window.wschodJutro = null; 
        window.zachodJutro = null; 
        window.swietaRuchomeCache = {};
        window.bazaSentencji = null; 

        // ================================================================
        // --- FUNKCJE POMOCNICZE (HELPER FUNCTIONS) ---
        // ================================================================

        // MODYFIKACJA (WARUNEK D≈ÅUGO≈öCI): Inteligentny Scroll
        // Funkcja sprawdza d≈Çugo≈õƒá tekstu i wy≈ÇƒÖcza animacjƒô, je≈õli tekst siƒô mie≈õci.
        function ustawTekstScrolla(idTracka, tekst) {
            const track = document.getElementById(idTracka);
            if (!track) return;

            const container = track.parentElement; // .scroller-wrap
            const spans = track.querySelectorAll('.scroller-content');

            // 1. Wpisz tekst do obu kopii
            spans.forEach(span => {
                span.textContent = tekst;
            });

            // 2. Reset stanu do pomiaru (w≈ÇƒÖcz widoczno≈õƒá, usu≈Ñ blokady)
            track.classList.remove('stopped');
            spans[1].style.display = 'inline-block';
            container.style.maskImage = '';
            container.style.webkitMaskImage = '';

            // 3. Pomiar
            // Pobieramy szeroko≈õƒá jednego elementu tekstowego (uwzglƒôdnia padding-right)
            const spanWidthTotal = spans[0].getBoundingClientRect().width;
            
            // Pobieramy padding-right z CSS (jest to 100px w tym pliku)
            // Pobieramy go dynamicznie dla pewno≈õci
            const computedStyle = window.getComputedStyle(spans[0]);
            const paddingRight = parseFloat(computedStyle.paddingRight) || 0;
            
            // Faktyczna szeroko≈õƒá samego tekstu
            const textRealWidth = spanWidthTotal - paddingRight;

            // Szeroko≈õƒá kontenera (okna widoku)
            const containerWidth = container.getBoundingClientRect().width;

            // Oblicz szeroko≈õƒá bufora "3 znak√≥w"
            // Dla czcionki monospaced (Courier New) stosunek szeroko≈õci do wysoko≈õci to ok. 0.6
            const fontSize = parseFloat(computedStyle.fontSize);
            const threeCharsBuffer = (fontSize * 0.6) * 3; 

            // 4. Warunek: Czy tekst (+ bufor 3 znak√≥w) jest d≈Çu≈ºszy ni≈º kontener?
            // Je≈õli (Tekst > Kontener - 3znaki), to animujemy.
            // W przeciwnym razie stopujemy.
            
            if (textRealWidth > (containerWidth - threeCharsBuffer)) {
                // Pozostaw animacjƒô w≈ÇƒÖczonƒÖ (nic nie r√≥b, zresetowali≈õmy jƒÖ w pkt 2)
            } else {
                // Wy≈ÇƒÖcz animacjƒô
                track.classList.add('stopped');
                spans[1].style.display = 'none'; // Ukryj duplikat, ≈ºeby nie przeszkadza≈Ç
                container.style.maskImage = 'none'; // Usu≈Ñ gradienty zanikania
                container.style.webkitMaskImage = 'none';
            }
        }

        function stworzCyfre(id) {
            const cyfraDiv = document.createElement('div');
            cyfraDiv.classList.add('cyfra');
            cyfraDiv.id = id;
            const segmenty = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
            segmenty.forEach(seg => {
                const segmentDiv = document.createElement('div');
                segmentDiv.classList.add('segment', seg);
                cyfraDiv.appendChild(segmentDiv);
            });
            return cyfraDiv;
        }

        function stworzSeparator(rodzaj) {
            const separatorDiv = document.createElement('div');
            separatorDiv.classList.add('separator', `separator-${rodzaj}`);
            if (rodzaj === 'dwukropek') {
                separatorDiv.classList.add('mrugajacy');
            }
            return separatorDiv;
        }

        function inicjalizujZegar() {
            const kontenerGlowny = document.getElementById('zegar-segmentowy-kontener');
            if (!kontenerGlowny) return; 

            const kontenerLinii = document.createElement('div');
            kontenerLinii.classList.add('kontener-linii');

            STRUKTURA_DATY.forEach(el => {
                if (el.typ === 'cyfra') {
                    kontenerLinii.appendChild(stworzCyfre(el.id));
                } else if (el.typ === 'separator') {
                    kontenerLinii.appendChild(stworzSeparator(el.rodzaj));
                }
            });

            const spacer = document.createElement('div');
            spacer.classList.add('separator-spacer');
            kontenerLinii.appendChild(spacer);

            STRUKTURA_CZASU.forEach(el => {
                if (el.typ === 'cyfra') {
                    kontenerLinii.appendChild(stworzCyfre(el.id));
                } else if (el.typ === 'separator') {
                    kontenerLinii.appendChild(stworzSeparator(el.rodzaj));
                }
            });

            kontenerGlowny.appendChild(kontenerLinii);
        }

        function ustawCyfre(elementId, cyfra) {
            const el = document.getElementById(elementId);
            if (!el) return; 
            const cyfraStr = String(cyfra);
            const segmentyDoWlaczenia = MAPA_SEGMENTOW[cyfraStr];
            
            el.querySelectorAll('.segment').forEach(s => s.classList.remove('active'));
            if (segmentyDoWlaczenia) {
                segmentyDoWlaczenia.forEach(seg => {
                    const segmentElement = el.querySelector(`.segment.${seg}`);
                    if (segmentElement) {
                        segmentElement.classList.add('active');
                    }
                });
            }
        }

        function formatujLiczbe(liczba) {
            return String(liczba).padStart(2, '0');
        }

        function formatujGodzine(data) {
            if (data && typeof data.getHours === 'function') {
                const godzina = formatujLiczbe(data.getHours());
                const minuta = formatujLiczbe(data.getMinutes());
                return `${godzina}:${minuta}`;
            }
            return 'b/d'; 
        }

        function obliczDzienRoku(data) {
            const startRoku = new Date(data.getFullYear(), 0, 0); 
            const diff = data - startRoku; 
            const jedenDzienMs = 1000 * 60 * 60 * 24;
            return Math.floor(diff / jedenDzienMs);
        }

        function obliczNumerTygodnia(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            var weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return weekNo;
        }

        function obliczKwartal(data) {
            return Math.floor(data.getMonth() / 3) + 1; 
        }

        function formatujDelteCzasu(ms) {
            let totalSeconds = Math.floor(Math.max(ms, 0) / 1000); 
            let hours = Math.floor(totalSeconds / 3600);
            totalSeconds %= 3600;
            let minutes = Math.floor(totalSeconds / 60);
            let seconds = totalSeconds % 60;
            return `${formatujLiczbe(hours)}:${formatujLiczbe(minutes)}:${formatujLiczbe(seconds)}`;
        }

        function formatujDlugoscDnia(ms) {
            let totalMinutes = Math.floor(Math.max(ms, 0) / (1000 * 60));
            let hours = Math.floor(totalMinutes / 60);
            let minutes = totalMinutes % 60;
            return `${hours} godz. ${minutes} min.`;
        }

        function czyRokPrzestepny(rok) {
            return (rok % 4 === 0 && rok % 100 !== 0) || rok % 400 === 0;
        }

        function iloscTygodniWRoku(rok) {
            return obliczNumerTygodnia(new Date(rok, 11, 28));
        }

        function obliczWielkanoc(rok) {
            const a = rok % 19, b = Math.floor(rok / 100), c = rok % 100, d = Math.floor(b / 4), e = b % 4, f = Math.floor((b + 8) / 25), g = Math.floor((b - f + 1) / 3), h = (19 * a + b - d - g + 15) % 30, i = Math.floor(c / 4), k = c % 4, l = (32 + 2 * e + 2 * i - h - k) % 7, m = Math.floor((a + 11 * h + 22 * l) / 451), miesiac = Math.floor((h + l - 7 * m + 114) / 31), dzien = ((h + l - 7 * m + 114) % 31) + 1;
            return new Date(rok, miesiac - 1, dzien);
        }

        function dodajDniDoDaty(data, dni) {
            const nowaData = new Date(data);
            nowaData.setDate(nowaData.getDate() + dni);
            return nowaData;
        }

        function formatujDateNaKlucz(data) {
            return `${formatujLiczbe(data.getMonth() + 1)}-${formatujLiczbe(data.getDate())}`;
        }

        function decToDMS(dec, isLng) {
            let deg = Math.abs(dec);
            let d = Math.floor(deg);
            let min = (deg - d) * 60;
            let m = Math.floor(min);
            let sec = (min - m) * 60;
            let s = Math.round(sec);
            if (s === 60) { m++; s = 0; }
            if (m === 60) { d++; m = 0; }
            let dir = isLng ? (dec >= 0 ? 'E' : 'W') : (dec >= 0 ? 'N' : 'S');
            return `${d}¬∞ ${formatujLiczbe(m)}‚Ä≤ ${formatujLiczbe(s)}‚Ä≥ ${dir}`;
        }

        function pobierzInfoZodiaku(data) {
            const dzien = data.getDate();
            const miesiac = data.getMonth() + 1;
            
            const znakiOdwrocone = [...ZNAKI_ZODIAKU].reverse();
            
            const biezacyZnak = znakiOdwrocone.find(znak => {
                return miesiac > znak.start[0] || (miesiac === znak.start[0] && dzien >= znak.start[1]);
            });

            if (!biezacyZnak) { 
                return ZNAKI_ZODIAKU.find(z => z.nazwa === 'Kozioro≈ºec'); 
            }
            return biezacyZnak;
        }

        function pobierzInfoKsiezyca(f) {
            if (f <= 0.03 || f > 0.97) return { nazwa: 'N√≥w', emoji: 'üåë', index: 1 };
            if (f <= 0.22) return { nazwa: 'Sierp przybywajƒÖcy', emoji: 'üåí', index: 2 };
            if (f <= 0.28) return { nazwa: 'Pierwsza Kwadra', emoji: 'üåì', index: 3 };
            if (f <= 0.47) return { nazwa: 'Garbaty przybywajƒÖcy', emoji: 'üåî', index: 4 };
            if (f <= 0.53) return { nazwa: 'Pe≈Çnia', emoji: 'üåï', index: 5 };
            if (f <= 0.72) return { nazwa: 'Garbaty ubywajƒÖcy', emoji: 'üåñ', index: 6 };
            if (f <= 0.78) return { nazwa: 'Ostatnia Kwadra', emoji: 'üåó', index: 7 };
            return { nazwa: 'Sierp ubywajƒÖcy', emoji: 'üåò', index: 8 };
        }

        function obliczNastepnyZnak(teraz) {
            const infoZodiaku = pobierzInfoZodiaku(teraz);
            const obecnyIndex = ZNAKI_ZODIAKU.findIndex(z => z.nazwa === infoZodiaku.nazwa);
            const nastepnyIndex = (obecnyIndex + 1) % ZNAKI_ZODIAKU.length;
            const nastepnyZnak = ZNAKI_ZODIAKU[nastepnyIndex];

            const rok = teraz.getFullYear();
            let dataStartu = new Date(rok, nastepnyZnak.start[0] - 1, nastepnyZnak.start[1]);
            if (dataStartu < teraz) {
                dataStartu.setFullYear(rok + 1);
            }

            const diffMs = dataStartu.getTime() - teraz.getTime();
            const diffDni = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
            return { nazwa: nastepnyZnak.nazwa, dni: diffDni };
        }

        function obliczNastepnaPelnie(teraz) {
            if (typeof SunCalc === 'undefined') return 'b/d';
            let fazaPoprzednia = SunCalc.getMoonIllumination(teraz).phase;
            let dataPetli = new Date(teraz.getTime());
            for (let i = 0; i < 720; i++) {
                dataPetli.setHours(dataPetli.getHours() + 1); 
                let fazaNowa = SunCalc.getMoonIllumination(dataPetli).phase;
                if (fazaPoprzednia < 0.5 && fazaNowa >= 0.5) {
                    const diffMs = dataPetli.getTime() - teraz.getTime();
                    const diffDni = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
                    return diffDni;
                }
                fazaPoprzednia = fazaNowa;
            }
            return 'b/d'; 
        }

        function obliczZmianeFazyWizualnej(teraz) {
            if (typeof SunCalc === 'undefined') return 'b/d';
            const infoTeraz = pobierzInfoKsiezyca(SunCalc.getMoonIllumination(teraz).phase);
            const indeksAktualny = infoTeraz.index;
            let dataPetli = new Date(teraz.getTime());
            for (let i = 0; i < 240; i++) {
                dataPetli.setHours(dataPetli.getHours() + 1); 
                let fazaPrzyszla = SunCalc.getMoonIllumination(dataPetli).phase;
                let infoPrzyszle = pobierzInfoKsiezyca(fazaPrzyszla);
                if (infoPrzyszle.index !== indeksAktualny) {
                    const diffMs = dataPetli.getTime() - teraz.getTime();
                    const diffDni = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
                    return diffDni === 0 ? 1 : diffDni;
                }
            }
            return 'b/d';
        }

        function mapujKodPogody(code) {
            if (code === 0) return { ikona: '‚òÄÔ∏è', opis: 'Bezchmurnie' };
            if (code === 1) return { ikona: 'üå§Ô∏è', opis: 'G≈Ç√≥wnie bezchmurnie' };
            if (code === 2) return { ikona: 'üå•Ô∏è', opis: 'Czƒô≈õciowe zachmurzenie' };
            if (code === 3) return { ikona: '‚òÅÔ∏è', opis: 'Zachmurzenie' };
            if (code >= 45 && code <= 48) return { ikona: 'üå´Ô∏è', opis: 'Mg≈Ça' };
            if (code >= 51 && code <= 55) return { ikona: 'üå¶Ô∏è', opis: 'M≈ºawka' };
            if (code >= 56 && code <= 57) return { ikona: 'ü•∂', opis: 'MarznƒÖca m≈ºawka' };
            if (code >= 61 && code <= 65) return { ikona: 'üåßÔ∏è', opis: 'Deszcz' };
            if (code >= 66 && code <= 67) return { ikona: 'ü•∂', opis: 'MarznƒÖcy deszcz' };
            if (code >= 71 && code <= 75) return { ikona: '‚ùÑÔ∏è', opis: '≈önieg' };
            if (code === 77) return { ikona: 'üå®Ô∏è', opis: 'Ziarna ≈õnie≈ºne' };
            if (code >= 80 && code <= 82) return { ikona: 'üåßÔ∏è', opis: 'Przelotne opady deszczu' };
            if (code >= 85 && code <= 86) return { ikona: 'üå®Ô∏è', opis: 'Przelotne opady ≈õniegu' };
            if (code >= 95 && code <= 99) return { ikona: '‚õàÔ∏è', opis: 'Burza' };
            return { ikona: '‚ùì', opis: 'Nieznana' }; 
        }

        function stopnieNaKierunek(stopnie) {
            const kierunki = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const index = Math.round(stopnie / 45) % 8;
            return kierunki[index];
        }

        function dopasujSkale() {
            const kontener = document.getElementById('kontener');
            const szerokoscOkna = window.innerWidth;
            
            const bazowaSzerokosc = 1000; 
            const marginesBoczny = 20; 

            const dostepnaSzerokosc = szerokoscOkna - (marginesBoczny * 2);

            if (dostepnaSzerokosc < bazowaSzerokosc) {
                const skala = dostepnaSzerokosc / bazowaSzerokosc;
                kontener.style.transform = `scale(${skala})`;
                kontener.style.marginTop = '10px';
            } else {
                kontener.style.transform = 'none';
                kontener.style.marginTop = '20px';
            }
        }

        // ================================================================
        // --- FUNKCJE DO OBS≈ÅUGI SENTENCJI ---
        // ================================================================

        async function pobierzBazeSentencji() {
            try {
                const response = await fetch('sentencje.json');
                if (!response.ok) {
                    throw new Error('B≈ÇƒÖd sieci przy pobieraniu sentencji');
                }
                window.bazaSentencji = await response.json();
                console.log("Sentencje za≈Çadowane.");
                aktualizujSentencje(new Date());
            } catch (error) {
                console.error("Nie uda≈Ço siƒô pobraƒá sentencji:", error);
                ustawTekstScrolla('sentencja-track', "Mi≈Çego dnia!");
            }
        }

        function aktualizujSentencje(teraz) {
            if (!window.bazaSentencji) return; 

            const dzienRoku = obliczDzienRoku(teraz);
            const wpis = window.bazaSentencji.find(item => item.dzien === dzienRoku);
            
            const tekst = wpis ? `‚Äû${wpis.tekst}‚Äù` : "Chwytaj dzie≈Ñ!";
            
            // U≈ºywamy nowej funkcji do ustawienia tekstu w pƒôtli
            ustawTekstScrolla('sentencja-track', tekst);
        }

        // ================================================================
        // --- G≈Å√ìWNE FUNKCJE APLIKACJI ---
        // ================================================================
        
        function wyswietlWspolrzedne() {
            const latDMS = decToDMS(BIEZACA_LAT, false);
            const lonDMS = decToDMS(BIEZACA_LON, true);
            const wspolrzedneEl = document.getElementById('wspolrzedne-tekst');
            if (wspolrzedneEl) {
                wspolrzedneEl.textContent = `${latDMS}, ${lonDMS}`;
            }
        }

        async function aktualizujPogode() {
            const lat = BIEZACA_LAT;
            const lon = BIEZACA_LON;
            
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,pressure_msl,wind_speed_10m,wind_direction_10m&hourly=pressure_msl&past_days=1&temperature_unit=celsius&timezone=auto`;
            
            const ikonaEl = document.getElementById('pogoda-ikona');
            const infoEl = document.getElementById('pogoda-info');
            const cisnienieInfoEl = document.getElementById('cisnienie-info');
            const cisnienieTrendEl = document.getElementById('cisnienie-trend');
            const wiatrInfoEl = document.getElementById('wiatr-info');
            const wiatrIkonaEl = document.getElementById('wiatr-wskaznik');

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`B≈ÇƒÖd sieci: ${response.statusText}`);
                const data = await response.json();

                if (data && data.current) {
                    if (data.current.temperature_2m !== undefined) {
                        const temp = data.current.temperature_2m;
                        const code = data.current.weather_code;
                        const pogoda = mapujKodPogody(code);
                        ikonaEl.textContent = pogoda.ikona;
                        infoEl.textContent = `${Math.round(temp)}¬∞C, ${pogoda.opis}`;
                    }
                    
                    let cisnienieObecne = null;
                    if (data.current.pressure_msl !== undefined) {
                        cisnienieObecne = Math.round(data.current.pressure_msl);
                        cisnienieInfoEl.textContent = `${cisnienieObecne} hPa`;
                    } else {
                        cisnienieInfoEl.textContent = "b/d";
                    }

                    if (cisnienieObecne !== null && data.hourly && data.hourly.pressure_msl) {
                        const teraz = new Date();
                        const aktualnaGodzina = teraz.getHours();
                        const indeksDzis = 24 + aktualnaGodzina;
                        const indeksGodzineTemu = indeksDzis - 1;

                        if (data.hourly.pressure_msl[indeksGodzineTemu] !== undefined) {
                            const cisnieniePoprzednie = data.hourly.pressure_msl[indeksGodzineTemu];
                            const roznica = cisnienieObecne - cisnieniePoprzednie;

                            if (roznica > 0.5) {
                                cisnienieTrendEl.textContent = "‚ÜóÔ∏è"; 
                                cisnienieTrendEl.className = "trend-wzrost";
                            } else if (roznica < -0.5) {
                                cisnienieTrendEl.textContent = "‚ÜòÔ∏è"; 
                                cisnienieTrendEl.className = "trend-spadek";
                            } else {
                                cisnienieTrendEl.textContent = "‚û°Ô∏è"; 
                                cisnienieTrendEl.className = "trend-stale";
                            }
                        } else {
                            cisnienieTrendEl.textContent = "";
                        }
                    }

                    if (data.current.wind_speed_10m !== undefined && data.current.wind_direction_10m !== undefined) {
                        const predkosc = Math.round(data.current.wind_speed_10m);
                        const kierunekStopnie = data.current.wind_direction_10m;
                        const kierunekTekst = stopnieNaKierunek(kierunekStopnie);
                        
                        wiatrInfoEl.textContent = `${predkosc} km/h ${kierunekTekst}`;
                        wiatrIkonaEl.style.transform = `rotate(${kierunekStopnie}deg)`; 
                    } else {
                         wiatrInfoEl.textContent = "b/d";
                         wiatrIkonaEl.style.transform = "rotate(0deg)";
                    }

                } else {
                    throw new Error('Nieprawid≈Çowa odpowied≈∫ z API pogody');
                }
            } catch (error) {
                console.error('B≈ÇƒÖd pobierania pogody:', error);
                ikonaEl.textContent = 'üì°'; 
                infoEl.textContent = 'B≈ÇƒÖd pogody';
                if(cisnienieInfoEl) cisnienieInfoEl.textContent = '---';
                if(cisnienieTrendEl) cisnienieTrendEl.textContent = '';
                if(wiatrInfoEl) wiatrInfoEl.textContent = '...';
            }
        }

        async function aktualizujNazweLokalizacji() {
            const lat = BIEZACA_LAT;
            const lon = BIEZACA_LON;
            const url = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=pl`;
            const nazwaEl = document.getElementById('lokalizacja-nazwa');

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('B≈ÇƒÖd sieci geocoding');
                const data = await response.json();
                
                if (data && data.city) {
                    let nazwa = data.city; 
                    if (data.principalSubdivision) { 
                        let wojewodztwo = data.principalSubdivision.replace("Wojew√≥dztwo ", "woj. ");
                        nazwa += `, ${wojewodztwo}`;
                    } else if (data.countryName) { 
                        nazwa += `, ${data.countryName}`;
                    }
                    BIEZACA_LOKALIZACJA_NAZWA = nazwa;
                } else if (data && data.locality) {
                    BIEZACA_LOKALIZACJA_NAZWA = data.locality;
                } else {
                    throw new Error('Nie znaleziono nazwy');
                }

            } catch (error) {
                console.error('B≈ÇƒÖd lokalizacji:', error);
                BIEZACA_LOKALIZACJA_NAZWA = "B≈ÇƒÖd API (Nazwa)";
            }
            nazwaEl.textContent = BIEZACA_LOKALIZACJA_NAZWA;
        }

        function dobierzKoncowkeDni(liczba) {
            return (liczba === 1) ? "dzie≈Ñ" : "dni";
        }

        function aktualizujDaneCodzienne(teraz) {
            console.log(`AKTUALIZACJA DANYCH CODZIENNYCH o ${teraz}`);
            const rok = teraz.getFullYear();
            
            let sunCalcDostepny = typeof SunCalc !== 'undefined';
            if (sunCalcDostepny) {
                const jutro = new Date(teraz);
                jutro.setDate(teraz.getDate() + 1);

                const daneDzis = SunCalc.getTimes(teraz, BIEZACA_LAT, BIEZACA_LON);
                const daneJutro = SunCalc.getTimes(jutro, BIEZACA_LAT, BIEZACA_LON);

                window.wschodDzis = daneDzis.sunrise;
                window.zachodDzis = daneDzis.sunset;
                window.wschodJutro = daneJutro.sunrise;
                window.zachodJutro = daneJutro.sunset; 

                if (window.wschodDzis && window.zachodDzis) {
                    const poprawnaDlugoscDniaMs = window.zachodDzis.getTime() - window.wschodDzis.getTime();
                    document.getElementById('czas-dnia').textContent = formatujDlugoscDnia(poprawnaDlugoscDniaMs);
                } else {
                    document.getElementById('czas-dnia').textContent = "b/d";
                }
                
            } else {
                document.getElementById('wschod').textContent = "b/d";
                document.getElementById('zachod').textContent = "b/d";
                document.getElementById('czas-dnia').textContent = "b/d";
            }

            const dzienRoku = obliczDzienRoku(teraz);
            const maxDniWRoku = czyRokPrzestepny(rok) ? 366 : 365;
            const dniDoKonca = maxDniWRoku - dzienRoku;
            const kwartal = obliczKwartal(teraz);

            document.getElementById('dzien-roku').textContent = dzienRoku;
            document.getElementById('max-dzien-roku').textContent = maxDniWRoku;
            document.getElementById('dni-do-konca').textContent = dniDoKonca;
            document.getElementById('dni-do-konca-sufiks').textContent = dobierzKoncowkeDni(dniDoKonca);

            document.getElementById('tydzien-roku').textContent = obliczNumerTygodnia(teraz);
            document.getElementById('max-tydzien-roku').textContent = iloscTygodniWRoku(rok);
            document.getElementById('kwartal').textContent = kwartal;

            const dzisKlucz = formatujDateNaKlucz(teraz); 
            const wszystkieSwieta = [];

            const swietoStale = SWIETA_STALE[dzisKlucz];
            if (swietoStale) wszystkieSwieta.push(swietoStale);

            if (!window.swietaRuchomeCache[rok]) {
                const wielkanoc = obliczWielkanoc(rok);
                const ponWielkanocny = dodajDniDoDaty(wielkanoc, 1);
                const zieloneSwiatki = dodajDniDoDaty(wielkanoc, 49);
                const bozeCialo = dodajDniDoDaty(wielkanoc, 60);

                window.swietaRuchomeCache[rok] = {};
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(wielkanoc)] = 'Niedziela Wielkanocna';
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(ponWielkanocny)] = 'Poniedzia≈Çek Wielkanocny';
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(zieloneSwiatki)] = 'Zielone ≈öwiƒÖtki';
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(bozeCialo)] = 'Bo≈ºe Cia≈Ço';
            }
            const swietoRuchome = window.swietaRuchomeCache[rok][dzisKlucz];
            if (swietoRuchome) wszystkieSwieta.push(swietoRuchome);

            if(typeof SWIETA_NIETYPOWE_BAZA !== 'undefined') {
                const swietoNietypowe = SWIETA_NIETYPOWE_BAZA[dzisKlucz];
                if (swietoNietypowe) wszystkieSwieta.push(swietoNietypowe);
            }
            
            // USTAWIENIE TEKSTU ≈öWIƒòTA (SCROLL)
            const tekstSwieta = wszystkieSwieta.length ? `${wszystkieSwieta.join(', ')}` : "(brak)";
            ustawTekstScrolla('swieto-track', tekstSwieta);

            let imieniny = "b/d";
            if (typeof IMIENINY_BAZA !== 'undefined') {
                imieniny = IMIENINY_BAZA[dzisKlucz] || "brak";
            }
            // USTAWIENIE TEKSTU IMIENIN (SCROLL)
            ustawTekstScrolla('imiona-track', imieniny);

            const infoZodiaku = pobierzInfoZodiaku(teraz);
            document.getElementById('zodiak-nazwa').textContent = infoZodiaku.nazwa;
            document.getElementById('zodiak-obraz').textContent = infoZodiaku.emoji;

            if (sunCalcDostepny) {
                const moonInfo = SunCalc.getMoonIllumination(teraz);
                const infoKsiezyca = pobierzInfoKsiezyca(moonInfo.phase);
                document.getElementById('faza-ksiezyca-nazwa').textContent = infoKsiezyca.nazwa;
                document.getElementById('faza-ksiezyca-obraz').textContent = infoKsiezyca.emoji;
                document.getElementById('faza-ksiezyca-numer').textContent = infoKsiezyca.index;
            } else {
                document.getElementById('faza-ksiezyca-nazwa').textContent = "b/d";
                document.getElementById('faza-ksiezyca-obraz').textContent = "üõ∞Ô∏è";
                document.getElementById('faza-ksiezyca-numer').textContent = "?";
            }

            const infoNastepnegoZnaku = obliczNastepnyZnak(teraz);
            document.getElementById('zodiak-countdown-nazwa').textContent = infoNastepnegoZnaku.nazwa;
            document.getElementById('zodiak-countdown-dni').textContent = infoNastepnegoZnaku.dni;
            document.getElementById('zodiak-countdown-sufiks').textContent = dobierzKoncowkeDni(infoNastepnegoZnaku.dni);

            const dniDoPelni = obliczNastepnaPelnie(teraz);
            document.getElementById('pelnia-countdown-dni').textContent = dniDoPelni;
            if (typeof dniDoPelni === 'number') {
                 document.getElementById('pelnia-countdown-sufiks').textContent = dobierzKoncowkeDni(dniDoPelni);
            }
            
            const dniDoFazy = obliczZmianeFazyWizualnej(teraz);
            document.getElementById('faza-countdown-dni').textContent = dniDoFazy;
             if (typeof dniDoFazy === 'number') {
                 document.getElementById('faza-countdown-sufiks').textContent = dobierzKoncowkeDni(dniDoFazy);
            }

            aktualizujSentencje(teraz);
            aktualizujNazweLokalizacji(); 
            aktualizujPogode(); 
        }

        function aktualizujZegar() {
            const teraz = new Date();
            const dzienNumer = teraz.getDate(); 

            if (dzienNumer !== window.ostatniDzien) {
                aktualizujDaneCodzienne(teraz); 
                window.ostatniDzien = dzienNumer;
            }

            const nazwaDnia = DNI_TYGODNIA[teraz.getDay()];
            document.getElementById('dzien').textContent = nazwaDnia;

            const godzina = formatujLiczbe(teraz.getHours());
            const minuta = formatujLiczbe(teraz.getMinutes());
            const sekunda = formatujLiczbe(teraz.getSeconds());
            const dzien = formatujLiczbe(teraz.getDate());
            const miesiac = formatujLiczbe(teraz.getMonth() + 1);
            const rok = String(teraz.getFullYear());

            ustawCyfre('data-d1', dzien[0]);
            ustawCyfre('data-d2', dzien[1]);
            ustawCyfre('data-m1', miesiac[0]);
            ustawCyfre('data-m2', miesiac[1]);
            ustawCyfre('data-r1', rok[0]);
            ustawCyfre('data-r2', rok[1]);
            ustawCyfre('data-r3', rok[2]);
            ustawCyfre('data-r4', rok[3]);

            ustawCyfre('czas-h1', godzina[0]);
            ustawCyfre('czas-h2', godzina[1]);
            ustawCyfre('czas-m1', minuta[0]);
            ustawCyfre('czas-m2', minuta[1]);
            ustawCyfre('czas-s1', sekunda[0]);
            ustawCyfre('czas-s2', sekunda[1]);

            const sekundaParzysta = teraz.getSeconds() % 2 === 0;
            document.querySelectorAll('.mrugajacy').forEach(el => {
                el.classList.toggle('wygaszony', sekundaParzysta);
            });

            const wschodEl = document.getElementById('wschod');
            const zachodEl = document.getElementById('zachod');
            const odliczanieIkonaEl = document.getElementById('odliczanie-ikona');
            const odliczanieTekstEl = document.getElementById('odliczanie-tekst');

            if (!window.wschodDzis || !window.zachodDzis || !window.wschodJutro || !window.zachodJutro) {
                odliczanieTekstEl.textContent = (typeof SunCalc === 'undefined') ? "Brak SunCalc..." : "Inicjalizacja...";
                return; 
            }
            
            if (odliczanieIkonaEl.textContent === '') {
                odliczanieIkonaEl.textContent = '‚åõ';
            }

            let docelowyWschod = window.wschodDzis;
            let czyWschodJutro = false;
            if (teraz > window.wschodDzis) {
                docelowyWschod = window.wschodJutro;
                czyWschodJutro = true;
            }

            let docelowyZachod = window.zachodDzis;
            let czyZachodJutro = false;
            if (teraz > window.zachodDzis) {
                docelowyZachod = window.zachodJutro;
                czyZachodJutro = true;
            }

            wschodEl.textContent = formatujGodzine(docelowyWschod);
            zachodEl.textContent = formatujGodzine(docelowyZachod);

            const ustawEtykiety = (idDzis, idJutro, czyJutro) => {
                const elDzis = document.getElementById(idDzis);
                const elJutro = document.getElementById(idJutro);
                if(czyJutro) {
                    elDzis.className = 'etykieta-nieaktywna';
                    elJutro.className = 'etykieta-aktywna';
                } else {
                    elDzis.className = 'etykieta-aktywna';
                    elJutro.className = 'etykieta-nieaktywna';
                }
            };

            ustawEtykiety('wschod-lbl-dzis', 'wschod-lbl-jutro', czyWschodJutro);
            ustawEtykiety('zachod-lbl-dzis', 'zachod-lbl-jutro', czyZachodJutro);


            let celOdliczania, tekstOdliczania;
            
            if (teraz < window.wschodDzis) {
                celOdliczania = window.wschodDzis;
                tekstOdliczania = "Wsch√≥d s≈Ço≈Ñca za:";
            } else if (teraz < window.zachodDzis) {
                celOdliczania = window.zachodDzis;
                tekstOdliczania = "Zach√≥d s≈Ço≈Ñca za:";
            } else {
                celOdliczania = window.wschodJutro;
                tekstOdliczania = "Wsch√≥d s≈Ço≈Ñca za:";
            }

            const deltaMs = celOdliczania.getTime() - teraz.getTime();
            odliczanieTekstEl.textContent = `${tekstOdliczania} ${formatujDelteCzasu(deltaMs)}`;
        }

        function przelaczMenu() {
            document.getElementById("menu-dropdown").classList.toggle("pokaz");
        }

        function otworzLinkZewnetrzny(url) {
            if (confirm("‚ö†Ô∏è Uwaga!\n\nNastƒÖpi przekierowanie do zewnƒôtrznego serwisu (GitHub).\nCzy chcesz opu≈õciƒá aplikacjƒô?")) {
                window.open(url, '_blank');
            }
        }
        
        async function resetAplikacji() {
            if (!confirm("Czy na pewno chcesz zresetowaƒá aplikacjƒô?\nSpowoduje to wyczyszczenie pamiƒôci i ponowne pobranie danych.\n\nÔ∏è‚ö†Ô∏è Uwaga!‚ö†Ô∏è Ta czyno≈õƒá mo≈ºe potrwaƒá od kilku do kilkunastu sekund,\nw zale≈ºno≈õci od prƒôdko≈õci Twojego urzƒÖdzenia i Internetu.\nW tym czasie nie musisz nic robiƒá, czekaj cierpliwie, aplikacja sama siƒô uruchomi, kiedy proces pobierania danych siƒô zako≈Ñczy.")) {
                return; 
            }
            if ('caches' in window) {
                try {
                    const keys = await caches.keys();
                    await Promise.all(keys.map(key => caches.delete(key)));
                } catch (err) { console.error(err); }
            }
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (const registration of registrations) {
                    await registration.unregister();
                }
            }
            localStorage.clear();
            sessionStorage.clear();
            window.location.reload(true);
        }

        window.onclick = function(event) {
            if (!event.target.matches('.menu-przycisk')) {
                var dropdowns = document.getElementsByClassName("menu-tresc");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('pokaz')) {
                        openDropdown.classList.remove('pokaz');
                    }
                }
            }
        }

        window.addEventListener('resize', dopasujSkale);

        inicjalizujZegar();
        pobierzBazeSentencji();

        function uruchomAplikacje() {
            console.log("Uruchamianie aplikacji...");
            dopasujSkale(); 
            setTimeout(() => {
                aktualizujZegar();
                setInterval(aktualizujZegar, 1000);
            }, 100); 
            setInterval(aktualizujPogode, 15 * 60 * 1000);
        }

        function pobierzLokalizacje() {
            const ikonaEl = document.getElementById('lokalizacja-ikona');
            const wspolrzedneIkonaEl = document.getElementById('wspolrzedne-ikona');
            
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(geoSukces, geoBlad);
            } else {
                ikonaEl.textContent = 'üõ∞Ô∏è';
                wspolrzedneIkonaEl.textContent = '‚ùå'; 
                wyswietlWspolrzedne();
                uruchomAplikacje();
            }
        }

        function geoSukces(pozycja) {
            document.getElementById('lokalizacja-ikona').textContent = 'üìç';
            document.getElementById('wspolrzedne-ikona').textContent = 'üß≠'; 
            BIEZACA_LAT = pozycja.coords.latitude;
            BIEZACA_LON = pozycja.coords.longitude;
            wyswietlWspolrzedne();
            uruchomAplikacje();
        }

        function geoBlad(blad) {
            document.getElementById('lokalizacja-ikona').textContent = 'üõ∞Ô∏è';
            document.getElementById('wspolrzedne-ikona').textContent = '‚ùå'; 
            wyswietlWspolrzedne();
            uruchomAplikacje(); 
        }

        pobierzLokalizacje();

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.log(err));
            });
        }
    </script>

</body>
</html>

