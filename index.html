<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">

    <script src="suncalc.min.js"></script>

    <title>Kompletne Centrum Informacyjne</title>

    <style>
        /*
            Definicja g≈Ç√≥wnych zmiennych CSS (CSS variables) w :root.
            POW√ìD: Umo≈ºliwia to ≈ÇatwƒÖ zmianƒô kolorystyki ca≈Çej aplikacji
            w jednym miejscu. Zamiast szukaƒá i zmieniaƒá '#00FF00'
            w wielu miejscach, zmieniamy only '--kolor-aktywny'.
        */
        :root {
            --kolor-aktywny: #00FF00;
            --kolor-tla: #1a1a1a;
            --kolor-ramki: #000;
        }

        /*
            Podstawowe style dla 'body':
            - display: flex, justify-content, align-items: U≈ºywamy Flexboxa,
              aby wycentrowaƒá g≈Ç√≥wny kontener (#kontener) idealnie
              na ≈õrodku ekranu (zar√≥wno w pionie, jak i w poziomie).
            - min-height: 100vh: Gwarantuje, ≈ºe 'body' ma wysoko≈õƒá co najmniej
              ca≈Çego ekranu, co jest kluczowe dla centrowania w pionie.
            - box-sizing: border-box: W≈ÇƒÖcza "intuicyjny" model pude≈Çkowy,
              gdzie 'padding' i 'border' sƒÖ wliczane do ca≈Çkowitej
              szeroko≈õci/wysoko≈õci elementu, a nie dodawane na zewnƒÖtrz.
        */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            /* --- POPRAWKA T≈ÅA (POWR√ìT) ---
               Przywr√≥cono globalny kolor t≈Ça i tekstu
               zgodnie z TwojƒÖ pro≈õbƒÖ.
            */
            background-color: var(--kolor-tla);
            font-family: 'Courier New', Courier, monospace;
            color: var(--kolor-aktywny);
            padding: 20px;
            box-sizing: border-box;
        }

        /*
            G≈Ç√≥wny kontener aplikacji:
            - flex-direction: column: Ustawia elementy wewnƒÖtrz
              kontenera jeden pod drugim (w kolumnie).
        */
        #kontener {
            width: auto;
            max-width: 1000px;
            padding: 20px 30px;
            border: 4px solid var(--kolor-aktywny);
            border-radius: 10px;
            background-color: var(--kolor-ramki); /* T≈Ço wewnƒÖtrz ramki (#000) */
            /* --- POPRAWKA T≈ÅA (POWR√ìT) ---
               Usuniƒôto 'color', poniewa≈º jest ju≈º
               dziedziczony z 'body'.
            */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        /* --- Style tabeli nag≈Ç√≥wkowej (Dzie≈Ñ, Lokalizacja, Pogoda) --- */
        #tabela-naglowek {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        #tabela-naglowek td {
            padding: 5px;
            border: none;
            vertical-align: middle;
        }
        /* Du≈ºy napis z dniem tygodnia */
        .komorka-dzien {
            font-size: 3.5rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 5px var(--kolor-aktywny);
            width: auto; /* Zmieniono z 40% */
            text-align: center;
            vertical-align: middle;
            padding-right: 20px;
        }
        
        /* ZMIANA: Kom√≥rka z lokalizacjƒÖ i pogodƒÖ */
        .komorka-lokalizacja-pogoda {
            text-align: left;
            vertical-align: middle;
            border-left: 1px dotted #008000;
            padding-left: 15px;
            width: 60%; /* Zajmuje resztƒô miejsca */
        }
        
        /* --- NOWA LOGIKA STYLOWANIA LOKALIZACJI Z IKONƒÑ --- */
        #lokalizacja {
            font-size: 1.3rem;
            color: #00c000;
            font-weight: bold;
            min-height: 1.5rem;
            /* U≈ºywamy Flexboxa, aby wyr√≥wnaƒá ikonƒô i tekst */
            display: flex;
            align-items: center; 
        }
        #lokalizacja-ikona {
            font-size: 1.1rem; /* Mniejsza ikona */
            margin-right: 8px; /* Odstƒôp od tekstu */
            color: var(--kolor-aktywny); /* Kolor ikony */
        }
        /* #lokalizacja-nazwa (dziedziczy style z #lokalizacja) */
        
        /* --- NOWY ELEMENT: Wsp√≥≈Çrzƒôdne --- */
        #wspolrzedne {
            font-size: 0.9rem; /* Mniejsza czcionka */
            color: #87CEEB; /* Jasnoniebieski (SkyBlue) */
            margin-top: 4px;
            min-height: 1rem; /* Zapobiega skakaniu uk≈Çadu */
            /* NOWE: Dodano flex do wyr√≥wnania ikony */
            display: flex;
            align-items: center;
        }
        /* NOWE: Ikona dla wsp√≥≈Çrzƒôdnych */
        #wspolrzedne-ikona {
            margin-right: 8px;
            font-size: 1.1rem;
        }
        
        #pogoda {
            font-size: 1.1rem;
            color: var(--kolor-aktywny);
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        #pogoda-ikona {
            font-size: 1.8rem; /* Wiƒôksze emoji pogody */
            margin-right: 10px;
        }
        #pogoda-info {
            line-height: 1.4;
        }

        /* --- Style tabeli z informacjami rocznymi --- */
        #tabela-info-roczne {
            /* --- POPRAWKA BUGU POZYCJONOWANIA ---
               Usuniƒôto 'width: 100%' i zastƒÖpiono 'width: auto'.
               Tabela sama dopasuje szeroko≈õƒá do zawarto≈õci i zostanie
               wycentrowana przez nadrzƒôdny '#kontener'.
            */
            width: auto;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #00c000;
        }
        #tabela-info-roczne td {
            /* Usuniƒôto 'width: 33.33%' */
            padding: 3px 0;
            border: none;
            vertical-align: top;
        }
        /* Styl dla maksymalnych warto≈õci (np. /365) */
        #tabela-info-roczne .max {
            color: #008000;
        }
        /* Pod≈õwietlenie bie≈ºƒÖcych warto≈õci */
        #tabela-info-roczne span span,
        #tabela-info-roczne span#swieto-nowe,
        #tabela-info-roczne span#imiona-nowe {
            color: var(--kolor-aktywny);
            font-weight: bold;
        }
        
        /* Kolumna 1: Dzie≈Ñ roku, Sylwester */
        #tabela-info-roczne td:nth-child(1) {
            /* Usuniƒôto 'width: 30%' */
            text-align: right;
            padding-right: 10px;
        }
        /* Kolumna 2: Tydzie≈Ñ, Kwarta≈Ç */
        #tabela-info-roczne td:nth-child(2) {
            /* Usuniƒôto 'width: 30%' */
            text-align: right; 
            padding-right: 10px;
            padding-left: 10px;
            border-left: 1px dotted #008000;
        }
        /* Kolumna 3: ≈öwiƒôto, Imieniny */
        #tabela-info-roczne td:nth-child(3) {
            /* Usuniƒôto 'width: 40%' */
            text-align: left;
            padding-left: 10px;
            border-left: 1px dotted #008000;
            line-height: 1.4;
        }

        /* --- Style Zegara Segmentowego --- */
        #zegar-segmentowy-kontener {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 10px;
            width: 100%;
            /*
                POW√ìD: Je≈õli ekran jest bardzo wƒÖski, zegar segmentowy
                (kt√≥ry ma sta≈ÇƒÖ szeroko≈õƒá) bƒôdzie m√≥g≈Ç byƒá przewijany
                w poziomie, zamiast "rozpychaƒá" ca≈ÇƒÖ aplikacjƒô.
            */
            overflow-x: auto;
        }
        .kontener-linii {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: nowrap; /* Zapobiega ≈Çamaniu linii zegara */
            white-space: nowrap;
        }
        /*
            Kontener dla pojedynczej cyfry (7 segment√≥w):
            - position: relative: Jest to kluczowe. Ustawia "kontekst"
              pozycjonowania dla segment√≥w wewnƒÖtrz, kt√≥re bƒôdƒÖ
              u≈ºywaƒá 'position: absolute'.
        */
        .cyfra {
            position: relative;
            width: 30px;
            height: 50px;
            margin: 0 2px;
            flex-shrink: 0; /* Zapobiega kurczeniu siƒô cyfr */
        }
        /*
            Style dla pojedynczego segmentu:
            - position: absolute: Pozwala precyzyjnie umie≈õciƒá segment
              (np. 'top: 0', 'left: 5px') WEWNƒÑTRZ rodzica (.cyfra).
            - opacity: 0.1: Domy≈õlnie segmenty sƒÖ "wygaszone".
        */
        .segment {
            position: absolute;
            background-color: var(--kolor-aktywny);
            opacity: 0.1;
            transition: opacity 0.2s;
            border-radius: 2px;
            box-shadow: 0 0 5px var(--kolor-aktywny);
        }
        /* Klasa 'active' (dodawana przez JS) "zapala" segment */
        .segment.active {
            opacity: 1;
        }
        /*
            Precyzyjne pozycjonowanie ka≈ºdego z 7 segment√≥w (a-g)
            wewnƒÖtrz kontenera .cyfra o wymiarach 30x50.
        */
        .segment.a, .segment.d, .segment.g { width: 20px; height: 4px; left: 5px; }
        .segment.b, .segment.c, .segment.e, .segment.f { width: 4px; height: 20px; }
        .segment.a { top: 0; }
        .segment.d { top: 46px; }
        .segment.g { top: 23px; }
        .segment.b { top: 5px; left: 26px; }
        .segment.c { top: 25px; left: 26px; }
        .segment.f { top: 5px; left: 0; }
        .segment.e { top: 25px; left: 0; }

        /* --- Style Separator√≥w (Dwukropek, Kreska, Spacer) --- */
        .separator {
            height: 50px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }
        /*
            Dwukropek (np. 12:34)
            POW√ìD: Jest tworzony za pomocƒÖ pseudo-element√≥w ::before i ::after,
            co pozwala uniknƒÖƒá dodatkowych element√≥w w HTML.
        */
        .separator-dwukropek { width: 20px; }
        .separator-dwukropek::before,
        .separator-dwukropek::after {
            content: '';
            display: block;
            width: 4px;
            height: 4px;
            background-color: var(--kolor-aktywny);
            border-radius: 50%;
            box-shadow: 0 0 5px var(--kolor-aktywny);
            transition: opacity 0.1s;
        }
        .separator-dwukropek::before { margin-bottom: 8px; margin-top: 8px; }
        /* Klasa 'wygaszony' (dodawana przez JS) obs≈Çuguje mruganie */
        .separator-dwukropek.wygaszony::before,
        .separator-dwukropek.wygaszony::after {
            opacity: 0.1;
        }

        /* Kreska (np. 31-12) */
        .separator-kreska { width: 30px; display: flex; justify-content: center; align-items: center; }
        .separator-kreska::before {
            content: '';
            display: block;
            width: 20px;
            height: 4px;
            background-color: var(--kolor-aktywny);
            box-shadow: 0 0 5px var(--kolor-aktywny);
            border-radius: 2px;
        }

        /* Pusty separator (spacer) miƒôdzy datƒÖ a godzinƒÖ */
        .separator-spacer {
            width: 25px;
            height: 50px;
            flex-shrink: 0;
        }

        /* --- Style sekcji S≈Ço≈Ñca --- */
        #tabela-slonce {
            width: auto;
            border-collapse: collapse;
        }
        #tabela-slonce td {
            padding: 4px 8px;
            border: none;
            text-align: left;
            font-size: 1.3rem;
            color: #00c000;
            vertical-align: top;
            /* POPRAWKA BUGU #1: Zakomentowano display: flex */
            /* display: flex; */
            align-items: center;
        }
        #tabela-slonce span {
            font-weight: bold;
            /* POPRAWKA BUGU #2: Zakomentowano color */
            /* color: var(--kolor-aktywny); */
        }
        /* Odliczanie do wschodu/zachodu ma inny, wyr√≥≈ºniony kolor */
        #tabela-slonce #odliczanie-slonca {
            font-size: 1.3rem;
            color: #ffff00;
            text-shadow: 0 0 5px #ffff00;
            font-weight: normal;
            /* Przywr√≥cenie flex tylko dla kom√≥rki odliczania */
            display: flex;
            align-items: center;
        }
        
        /* NOWE: Style dla ikon w tabelach */
        .ikona-tabeli {
            margin-right: 8px;
            font-size: 1.1rem; /* Dopasowanie rozmiaru ikony */
            color: var(--kolor-aktywny);
        }
        #odliczanie-ikona {
            margin-right: 8px;
            font-size: 1.1rem;
            color: #ffff00; /* Dopasowanie do koloru odliczania */
        }


        /* --- NOWE: Style sekcji Astro (Zodiak, Ksiƒô≈ºyc) w tabeli --- */
        #tabela-astro {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .astro-komorka {
            /* POPRAWKA BUGU #3: Zakomentowano width: 50% */
            /* width: 50%; */
            vertical-align: top;
            padding: 4px 8px;
            /* ZMIANA: Zmniejszono czcionkƒô, aby tekst siƒô mie≈õci≈Ç */
            font-size: 1.2rem; 
            color: #00c000;
        }
        
        /* ZMIANA: Stosowanie separatora i wyr√≥wnania do WSZYSTKICH wierszy */
        #tabela-astro tr td:first-child {
            text-align: right;
            border-right: 1px dotted #008000;
            padding-right: 15px;
        }
        #tabela-astro tr td:last-child {
            text-align: left;
            padding-left: 15px;
        }

        .astro-item {
            display: flex;
            align-items: center;
            justify-content: flex-end; /* Wyr√≥wnanie dla prawej kolumny (Zodiak) */
        }
        /* Wyr√≥wnanie dla lewej kolumny (Ksiƒô≈ºyc) */
        #tabela-astro tr:nth-child(1) .astro-komorka:last-child .astro-item {
             justify-content: flex-start;
        }
        
        .astro-item span {
             color: var(--kolor-aktywny);
        }
        .zodiak-emoji, #faza-ksiezyca-obraz {
            font-size: 2.5rem;
            margin-right: 10px;
            text-shadow: none;
            width: 40px;
            text-align: center;
        }
        
        /* Wiersze z odliczaniem (styl) */
        .astro-countdown-komorka {
            font-size: 1.1rem;
            color: #008000;
            padding-top: 5px;
        }
        .astro-countdown-komorka span {
            color: var(--kolor-aktywny);
            font-weight: bold;
        }
        
        /* ZMIANA: Dodano styl dla separatora w tabeli astro */
        .astro-separator-maly {
            margin: 0 10px;
            font-size: 1.1rem;
            color: #008000;
        }


        /*
            ==================================================================
            --- SEKCJA RESPONSYWNA (RWD) DLA TELEFONU W POZIOMIE ---
            ==================================================================

            POW√ìD: Ta "magiczna" regu≈Ça @media aktywuje siƒô only wtedy,
            gdy urzƒÖdzenie jest w orientacji poziomej (landscape) ORAZ
            jego wysoko≈õƒá jest bardzo ma≈Ça (max-height: 500px).
            
            Cel: Precyzyjnie namierzyƒá telefony trzymane bokiem,
            aby zmusiƒá aplikacjƒô do trybu "pe≈Çnoekranowego" i zmniejszyƒá
            elementy, by zmie≈õci≈Çy siƒô na niskim ekranie.
        */
        @media (orientation: landscape) and (max-height: 500px) {

            /*
                POW√ìD: W trybie pe≈Çnoekranowym nie chcemy ≈ºadnych
                margines√≥w ani paddingu na 'body'.
            */
            body {
                padding: 0;
            }

            /*
                POW√ìD: To jest g≈Ç√≥wna regu≈Ça dla trybu pe≈Çnoekranowego.
                RozciƒÖgamy kontener na 100% szeroko≈õci (100vw) i
                100% wysoko≈õci (100vh) okna przeglƒÖdarki.
            */
            #kontener {
                width: 100vw;
                height: 100vh;
                max-width: none; /* Usuwa limit 1000px */
                border-radius: 0; /* Usuwa zaokrƒÖglone rogi */

                /*
                    KLUCZOWA W≈ÅA≈öCIWO≈öƒÜ (MAGIC):
                    POW√ìD: 'box-sizing: border-box' m√≥wi przeglƒÖdarce,
                    aby 'border' (4px) i 'padding' (10px) zosta≈Çy wliczone
                    DO WEWNƒÑTRZ wymiar√≥w 100vw/100vh. Bez tego, kontener
                    by≈Çby za du≈ºy o 2*(4px + 10px) i pojawi≈Çyby siƒô
                    paski przewijania (scrollbary).
                */
                box-sizing: border-box;

                /* Zmniejszamy padding, by zmie≈õciƒá wiƒôcej na niskim ekranie */
                padding: 10px 15px;
                
                /* Pozwala na przewijanie, je≈õli tre≈õƒá siƒô nie mie≈õci */
                overflow-y: auto;
            }

            /*
                --- ZMNIEJSZENIE CZCIONEK I ELEMENT√ìW ---
                POW√ìD: Ekran w poziomie jest bardzo niski, wiƒôc musimy
                agresywnie zmniejszyƒá czcionki i marginesy,
                aby zapobiec "rozpychaniu" uk≈Çadu.
            */

            .komorka-dzien {
                font-size: 2.5rem; /* By≈Ço 3.5rem */
                letter-spacing: 2px;
                padding-right: 10px;
            }

            /* ZMIANA: Style RWD dla pogody */
            .komorka-lokalizacja-pogoda {
                padding-left: 10px;
            }
            #lokalizacja {
                font-size: 1.0rem; /* By≈Ço 1.3rem */
            }
            /* NOWY STYL RWD DLA IKONY LOKALIZACJI */
            #lokalizacja-ikona {
                font-size: 0.9rem;
                margin-right: 5px;
            }
            /* NOWY STYL RWD DLA WSP√ì≈ÅRZƒòDNYCH */
            #wspolrzedne {
                font-size: 0.8rem;
                margin-top: 2px;
            }
            #wspolrzedne-ikona {
                 font-size: 0.9rem;
                 margin-right: 5px;
            }
            #pogoda {
                font-size: 0.9rem; /* By≈Ço 1.1rem */
                margin-top: 2px;
            }
            #pogoda-ikona {
                font-size: 1.3rem; /* By≈Ço 1.8rem */
                margin-right: 5px;
            }
            

            #tabela-info-roczne {
                font-size: 0.95rem; /* By≈Ço 1.1rem */
                margin-bottom: 5px;
            }
            /* ZMIANA: Mniejszy padding dla 3 kolumn */
            #tabela-info-roczne td:nth-child(1) { padding-right: 5px; }
            #tabela-info-roczne td:nth-child(2) { padding-right: 5px; padding-left: 5px; }
            #tabela-info-roczne td:nth-child(3) { padding-left: 5px; }

            /*
                POW√ìD: Skalujemy ca≈Çy zegar (cyfry i separatory) do 80%.
                Ustawiamy sta≈Çy, ma≈Çy margines '1px' (zamiast
                wcze≈õniejszego ujemnego), aby zapewniƒá czytelny odstƒôp
                miƒôdzy elementami po przeskalowaniu.
            */
            .cyfra, .separator {
                transform: scale(0.8);
                margin: 0 1px;
            }

            /* Zmniejszamy pustƒÖ przestrze≈Ñ miƒôdzy datƒÖ a godzinƒÖ */
            .separator-spacer {
                width: 15px; /* By≈Ço 25px */
            }

            /* Zmniejszamy odstƒôp pod zegarem */
            #zegar-segmentowy-kontener {
                margin-bottom: 5px;
            }

            /* Zmniejszamy czcionki dla sekcji S≈Ço≈Ñca */
            #tabela-slonce, #tabela-slonce #odliczanie-slonca {
                font-size: 1.0rem; /* By≈Ço 1.3rem */
            }
            #tabela-slonce td {
                padding: 2px 5px;
            }
            .ikona-tabeli, #odliczanie-ikona {
                font-size: 0.9rem;
                margin-right: 5px;
            }

            /* NOWE: Zmniejszamy sekcjƒô Astro (Tabela) */
            #tabela-astro {
                margin-top: 5px;
            }
            .astro-komorka {
                font-size: 0.9rem; /* By≈Ço 1.2rem */
                padding: 2px 5px;
            }
            #tabela-astro tr td:first-child { padding-right: 10px; }
            #tabela-astro tr td:last-child { padding-left: 10px; }
                
            .zodiak-emoji, #faza-ksiezyca-obraz {
                font-size: 2.0rem; /* By≈Ço 2.5rem */
                margin-right: 5px;
            }
            .astro-countdown-komorka {
                font-size: 0.8rem; /* By≈Ço 1.1rem */
                padding-top: 2px;
            }
            
            /* ZMIANA: Usuniƒôto regu≈Çƒô dla tr:nth-child(3), poniewa≈º wiersz nie istnieje */
        }


        /*
            ==================================================================
            --- SEKCJA BLOKADY ORIENTACJI (PORTRAIT LOCK) ---
            ==================================================================
        */

        /*
            POW√ìD: Domy≈õlnie ukrywamy komunikat o obr√≥cenie telefonu.
            Jest to pe≈Çnoekranowa nak≈Çadka (overlay), kt√≥ra czeka
            na aktywacjƒô przez regu≈Çƒô @media.
        */
        #obroc-urzadzenie {
            display: none; /* Domy≈õlnie ukryty */
            position: fixed; /* Pozycja wzglƒôdem okna przeglƒÖdarki */
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--kolor-ramki);
            color: var(--kolor-aktywny);
            z-index: 9999; /* Zapewnia, ≈ºe jest na samym wierzchu */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 1.5rem;
        }

        #obroc-urzadzenie .ikona {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: obrot-ikony 2s linear infinite;
        }

        /* Prosta animacja obrotu dla ikony üîÑ */
        @keyframes obrot-ikony {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /*
            "Magiczna" regu≈Ça blokujƒÖca:
            POW√ìD: Aktywuje siƒô, gdy urzƒÖdzenie jest w orientacji
            PIONOWEJ (portrait).
        */
        @media (orientation: portrait) {
            /* 1. Ukrywamy ca≈ÇƒÖ g≈Ç√≥wnƒÖ tre≈õƒá aplikacji */
            #kontener {
                display: none;
            }

            /* 2. Pokazujemy (jako 'flex') nasz komunikat blokady */
            #obroc-urzadzenie {
                display: flex;
            }
        }
    </style>
</head>
<body>

    <div id="obroc-urzadzenie">
        <div class="ikona">üì±üîÑ</div>
        <p>Proszƒô obr√≥ciƒá urzƒÖdzenie do pozycji poziomej.</p>
    </div>

    <div id="kontener">

        <table id="tabela-naglowek">
            <tr>
                <td class="komorka-dzien">
                    <span id="dzien">...</span>
                </td>
                <td class="komorka-lokalizacja-pogoda">
                    <div id="lokalizacja">
                        <span id="lokalizacja-ikona"></span>
                        <span id="lokalizacja-nazwa">Ustalanie lokalizacji...</span>
                    </div>
                    <div id="wspolrzedne">
                        <span id="wspolrzedne-ikona"></span>
                        <span id="wspolrzedne-tekst"></span>
                    </div>
                    <div id="pogoda">
                        <span id="pogoda-ikona">...</span>
                        <span id="pogoda-info">≈Åadowanie pogody...</span>
                    </div>
                </td>
            </tr>
        </table>

        <table id="tabela-info-roczne">
            <tr>
                <td>
                    Dzie≈Ñ roku: <span><span id="dzien-roku">...</span><span class="max">/<span id="max-dzien-roku">...</span></span></span>
                </td>
                <td>
                    Tydzie≈Ñ: <span><span id="tydzien-roku">...</span><span class="max">/<span id="max-tydzien-roku">...</span></span></span>
                </td>
                <td>
                    ≈öwiƒôto: <span id="swieto-nowe">...</span>
                </td>
            </tr>
            <tr>
                <td>
                    Sylwester za: <span><span id="dni-do-konca">...</span></span> dni
                </td>
                <td>
                    Kwarta≈Ç: <span><span id="kwartal">...</span><span class="max">/4</span></span>
                </td>
                <td>
                    Imieniny: <span id="imiona-nowe">...</span>
                </td>
            </tr>
        </table>

        <div id="zegar-segmentowy-kontener"></div>

        <table id="tabela-slonce">
            <tr>
                <td>
                    <span class="ikona-tabeli">‚òÄÔ∏è</span>Wsch√≥d: <span id="wschod">...</span>
                </td>
                <td>
                    <span class="ikona-tabeli">üï∞Ô∏è</span>D≈Çugo≈õƒá dnia: <span id="czas-dnia">...</span>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="ikona-tabeli">üåô</span>Zach√≥d: <span id="zachod">...</span>
                </td>
                <td id="odliczanie-slonca">
                    <span id="odliczanie-ikona" class="ikona-tabeli"></span>
                    <span id="odliczanie-tekst">≈Åadowanie...</span>
                </td>
            </tr>
        </table>

        <table id="tabela-astro">
            <tr>
                <td class="astro-komorka">
                    <div class="astro-item">
                        <span id="zodiak-obraz" class="zodiak-emoji">...</span>
                        <span>Znak zodiaku: <span id="zodiak-nazwa">...</span></span>
                    </div>
                </td>
                <td class="astro-komorka">
                    <div class="astro-item">
                        <span id="faza-ksiezyca-obraz">...</span>
                        <span>
                            Faza Ksiƒô≈ºyca (<span id="faza-ksiezyca-numer">...</span>/8):
                            <span id="faza-ksiezyca-nazwa">...</span>
                        </span>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="astro-komorka astro-countdown-komorka">
                    Zmiana na: <span id="zodiak-countdown-nazwa">...</span>
                    za: <span id="zodiak-countdown-dni">...</span> dni
                </td>
                <td class="astro-komorka astro-countdown-komorka">
                    Pe≈Çnia za: <span id="pelnia-countdown-dni">...</span> dni
                    <span class="astro-separator-maly">|</span>
                    Zmiana fazy za: <span id="faza-countdown-dni">...</span> dni
                </td>
            </tr>
            </table>
        
    </div>

    <script src="imieniny.js"></script>
    <script src="swieta.js"></script>

    <script>
        // ================================================================
        // --- SEKCJA KONFIGURACYJNA I STA≈ÅE (CONSTANTS) ---
        // ================================================================
        // POW√ìD: Przechowywanie sta≈Çych w jednym miejscu u≈Çatwia
        // zarzƒÖdzanie i modyfikacjƒô.

        // Tablica do mapowania numeru dnia (0=Niedziela) na polskƒÖ nazwƒô.
        const DNI_TYGODNIA = ['Niedziela', 'Poniedzia≈Çek', 'Wtorek', '≈öroda', 'Czwartek', 'PiƒÖtek', 'Sobota'];

        // ZMIANA: Domy≈õlne wsp√≥≈Çrzƒôdne (fallback). Zmienione z 'const' na 'let',
        // aby mo≈ºna je by≈Ço nadpisaƒá danymi z geolokalizacji.
        let BIEZACA_LAT = 51.6567; // Domy≈õlnie Pabianice
        let BIEZACA_LON = 19.3578; // Domy≈õlnie Pabianice
        let BIEZACA_LOKALIZACJA_NAZWA = "Pabianice, woj. ≈Å√≥dzkie"; // Domy≈õlna nazwa

        // Obiekt (mapa) przechowujƒÖcy sta≈Çe, ustawowe ≈õwiƒôta.
        // Klucz "MM-DD" pozwala na bardzo szybkie wyszukiwanie.
        const SWIETA_STALE = {
            '01-01': 'Nowy Rok', '01-06': 'Trzech Kr√≥li', '05-01': '≈öwiƒôto Pracy',
            '05-03': '≈öwiƒôto Konstyt. 3 Maja', '08-15': '≈öwiƒôto Wojska Polskiego, Wniebowziƒôcie NMP',
            '11-01': 'Wszystkich ≈öwiƒôtych', '11-11': 'Narodowe ≈öwiƒôto Niepodleg≈Ço≈õci',
            '12-25': 'Bo≈ºe Narodzenie (I dzie≈Ñ)', '12-26': 'Bo≈ºe Narodzenie (II dzie≈Ñ)'
        };

        // Dane dla oblicze≈Ñ znak√≥w zodiaku.
        const ZNAKI_ZODIAKU = [
            { nazwa: 'Kozioro≈ºec', start: [12, 22], emoji: '‚ôë' },
            { nazwa: 'Wodnik', start: [1, 20], emoji: '‚ôí' },
            { nazwa: 'Ryby', start: [2, 19], emoji: '‚ôì' },
            { nazwa: 'Baran', start: [3, 21], emoji: '‚ôà' },
            { nazwa: 'Byk', start: [4, 20], emoji: '‚ôâ' },
            { nazwa: 'Bli≈∫niƒôta', start: [5, 21], emoji: '‚ôä' },
            { nazwa: 'Rak', start: [6, 21], emoji: '‚ôã' },
            { nazwa: 'Lew', start: [7, 23], emoji: '‚ôå' },
            { nazwa: 'Panna', start: [8, 23], emoji: '‚ôç' },
            { nazwa: 'Waga', start: [9, 23], emoji: '‚ôé' },
            { nazwa: 'Skorpion', start: [10, 23], emoji: '‚ôè' },
            { nazwa: 'Strzelec', start: [11, 22], emoji: '‚ôê' }
        ];

        /*
            Mapa segment√≥w (Segment Map).
            POW√ìD: To jest "serce" wy≈õwietlacza 7-segmentowego.
            Definiuje, kt√≥re segmenty (a, b, c, d, e, f, g) muszƒÖ
            byƒá aktywne ('active'), aby wy≈õwietliƒá danƒÖ cyfrƒô.
            Np. cyfra '1' to only segmenty 'b' i 'c'.
        */
        const MAPA_SEGMENTOW = {
            '0': ['a', 'b', 'c', 'd', 'e', 'f'],
            '1': ['b', 'c'],
            '2': ['a', 'b', 'g', 'e', 'd'],
            '3': ['a', 'b', 'g', 'c', 'd'],
            '4': ['f', 'g', 'b', 'c'],
            '5': ['a', 'f', 'g', 'c', 'd'],
            '6': ['a', 'f', 'g', 'e', 'c', 'd'],
            '7': ['a', 'b', 'c'],
            '8': ['a', 'b', 'c', 'd', 'e', 'f', 'g'],
            '9': ['a', 'b', 'c', 'd', 'f', 'g'],
            ' ': [] // Pusty znak (spacja)
        };

        /*
            Struktury definiujƒÖce UK≈ÅAD zegara.
            POW√ìD: Zamiast kodowaƒá strukturƒô zegara w HTML, definiujemy
            jƒÖ jako tablicƒô obiekt√≥w. Funkcja 'inicjalizujZegar'
            przejdzie (przeiteruje) po tych tablicach i zbuduje
            z nich dynamicznie HTML. U≈Çatwia to zmianƒô uk≈Çadu,
            np. dodanie kolejnego separatora.
        */
        const STRUKTURA_DATY = [
            { typ: 'cyfra', id: 'data-d1' }, { typ: 'cyfra', id: 'data-d2' },
            { typ: 'separator', 'rodzaj': 'kreska' },
            { typ: 'cyfra', id: 'data-m1' }, { typ: 'cyfra', id: 'data-m2' },
            { typ: 'separator', 'rodzaj': 'kreska' },
            { typ: 'cyfra', id: 'data-r1' }, { typ: 'cyfra', id: 'data-r2' },
            { typ: 'cyfra', id: 'data-r3' }, { typ: 'cyfra', id: 'data-r4' }
        ];
        const STRUKTURA_CZASU = [
            { typ: 'cyfra', id: 'czas-h1' }, { typ: 'cyfra', id: 'czas-h2' },
            { typ: 'separator', 'rodzaj': 'dwukropek' },
            { typ: 'cyfra', id: 'czas-m1' }, { typ: 'cyfra', id: 'czas-m2' },
            { typ: 'separator', 'rodzaj': 'dwukropek' },
            { typ: 'cyfra', id: 'czas-s1' }, { typ: 'cyfra', id: 'czas-s2' }
        ];

        // ================================================================
        // --- ZMIENNE GLOBALNE (CACHE) ---
        // ================================================================
        // POW√ìD: Przechowujemy tu dane, kt√≥re sƒÖ kosztowne do obliczenia
        // lub potrzebne w r√≥≈ºnych funkcjach.

        // Przechowuje numer dnia (1-31), aby wykryƒá p√≥≈Çnoc.
        window.ostatniDzien = null;

        // Cache dla danych s≈Çonecznych. Obliczane raz dziennie.
        window.wschodDzis = null;
        window.zachodDzis = null;
        window.wschodJutro = null; // Potrzebne do odliczania po zachodzie s≈Ço≈Ñca
        window.zachodJutro = null; // NOWE: Potrzebne do wy≈õwietlania jutrzejszego zachodu

        // Cache dla ≈õwiƒÖt ruchomych (Wielkanoc itp.).
        // Kluczem jest rok (np. 2025), warto≈õciƒÖ jest obiekt z datami.
        window.swietaRuchomeCache = {};

        // ================================================================
        // --- FUNKCJE POMOCNICZE (HELPER FUNCTIONS) ---
        // ================================================================

        /**
         * Tworzy dynamicznie pojedynczƒÖ cyfrƒô (div) wraz z jej 7 segmentami.
         * @param {string} id - Unikalne ID dla tej cyfry (np. 'data-d1').
         * @returns {HTMLElement} Gotowy element <div>.cyfra.
         */
        function stworzCyfre(id) {
            const cyfraDiv = document.createElement('div');
            cyfraDiv.classList.add('cyfra');
            cyfraDiv.id = id;
            const segmenty = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
            segmenty.forEach(seg => {
                const segmentDiv = document.createElement('div');
                segmentDiv.classList.add('segment', seg);
                cyfraDiv.appendChild(segmentDiv);
            });
            return cyfraDiv;
        }

        /**
         * Tworzy dynamicznie element separatora (dwukropek, kreska).
         * @param {string} rodzaj - 'dwukropek' lub 'kreska'.
         * @returns {HTMLElement} Gotowy element <div>.separator.
         */
        function stworzSeparator(rodzaj) {
            const separatorDiv = document.createElement('div');
            separatorDiv.classList.add('separator', `separator-${rodzaj}`);
            // Dwukropki muszƒÖ mrugaƒá, wiƒôc dodajemy im specjalnƒÖ klasƒô.
            if (rodzaj === 'dwukropek') {
                separatorDiv.classList.add('mrugajacy');
            }
            return separatorDiv;
        }

        /**
         * Inicjalizuje zegar, budujƒÖc jego strukturƒô HTML na podstawie
         * sta≈Çych STRUKTURA_DATY i STRUKTURA_CZASU.
         * POW√ìD: Ta funkcja uruchamia siƒô only RAZ przy starcie aplikacji.
         */
        function inicjalizujZegar() {
            const kontenerGlowny = document.getElementById('zegar-segmentowy-kontener');
            if (!kontenerGlowny) return; // Zabezpieczenie, gdyby nie by≈Ço HTML

            const kontenerLinii = document.createElement('div');
            kontenerLinii.classList.add('kontener-linii');

            // Budowanie sekcji DATY
            STRUKTURA_DATY.forEach(el => {
                if (el.typ === 'cyfra') {
                    kontenerLinii.appendChild(stworzCyfre(el.id));
                } else if (el.typ === 'separator') {
                    kontenerLinii.appendChild(stworzSeparator(el.rodzaj));
                }
            });

            // Dodanie SPACERA miƒôdzy datƒÖ a godzinƒÖ
            const spacer = document.createElement('div');
            spacer.classList.add('separator-spacer');
            kontenerLinii.appendChild(spacer);

            // Budowanie sekcji CZASU
            STRUKTURA_CZASU.forEach(el => {
                if (el.typ === 'cyfra') {
                    kontenerLinii.appendChild(stworzCyfre(el.id));
                } else if (el.typ === 'separator') {
                    kontenerLinii.appendChild(stworzSeparator(el.rodzaj));
                }
            });

            // Wstawienie gotowej linii zegara do g≈Ç√≥wnego kontenera
            kontenerGlowny.appendChild(kontenerLinii);
        }

        /**
         * "Zapala" odpowiednie segmenty dla danej cyfry.
         * @param {string} elementId - ID cyfry do zaktualizowania (np. 'czas-s1').
         * @param {string|number} cyfra - Znak do wy≈õwietlenia ('0'-'9' lub ' ').
         */
        function ustawCyfre(elementId, cyfra) {
            const el = document.getElementById(elementId);
            if (!el) return; // Zabezpieczenie

            const cyfraStr = String(cyfra);
            // Pobranie listy segment√≥w do w≈ÇƒÖczenia z mapy (np. ['b', 'c'] dla '1')
            const segmentyDoWlaczenia = MAPA_SEGMENTOW[cyfraStr];

            // 1. Wy≈ÇƒÖcz (usu≈Ñ klasƒô 'active') wszystkie segmenty
            el.querySelectorAll('.segment').forEach(s => s.classList.remove('active'));

            // 2. W≈ÇƒÖcz only te segmenty, kt√≥re sƒÖ potrzebne
            if (segmentyDoWlaczenia) {
                segmentyDoWlaczenia.forEach(seg => {
                    const segmentElement = el.querySelector(`.segment.${seg}`);
                    if (segmentElement) {
                        segmentElement.classList.add('active');
                    }
                });
            }
        }

        /**
         * Formatuje liczbƒô do dw√≥ch znak√≥w, dodajƒÖc zero z przodu (np. 7 -> "07").
         * @param {number} liczba - Liczba do sformatowania.
         * @returns {string} Sformatowany tekst.
         */
        function formatujLiczbe(liczba) {
            return String(liczba).padStart(2, '0');
        }

        /**
         * Formatuje obiekt Date na czas HH:MM (np. "08:05").
         * @param {Date} data - Obiekt daty.
         * @returns {string} Sformatowany czas lub "b/d".
         */
        function formatujGodzine(data) {
            // Sprawdzenie, czy 'data' jest poprawnym obiektem Date
            if (data && typeof data.getHours === 'function') {
                /* --- POPRAWKA BUGU #2 (Krytyczny) ---
                   Poni≈ºej znajdowa≈Ça siƒô liter√≥wka "formatujLkiczbe".
                   Poprawiono na "formatujLiczbe".
                */
                const godzina = formatujLiczbe(data.getHours());
                const minuta = formatujLiczbe(data.getMinutes());
                return `${godzina}:${minuta}`;
            }
            return 'b/d'; // "brak danych"
        }

        /**
         * Oblicza numer dnia w roku (1-365 lub 1-366).
         * @param {Date} data - Obiekt daty.
         * @returns {number} Numer dnia.
         */
        function obliczDzienRoku(data) {
            const startRoku = new Date(data.getFullYear(), 0, 0); // Dzie≈Ñ "zerowy"
            const diff = data - startRoku; // R√≥≈ºnica w milisekundach
            const jedenDzienMs = 1000 * 60 * 60 * 24;
            return Math.floor(diff / jedenDzienMs);
        }

        /**
         * Oblicza numer tygodnia w roku (zgodnie ze standardem ISO 8601).
         * @param {Date} d - Obiekt daty.
         * @returns {number} Numer tygodnia.
         */
        function obliczNumerTygodnia(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            var weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return weekNo;
        }

        /**
         * Oblicza kwarta≈Ç (1-4) na podstawie miesiƒÖca.
         * @param {Date} data - Obiekt daty.
         * @returns {number} Numer kwarta≈Çu.
         */
        function obliczKwartal(data) {
            const miesiac = data.getMonth(); // 0-11
            return Math.floor(miesiac / 3) + 1; // (0-2)/3+1=1, (3-5)/3+1=2, ...
        }

        /**
         * Formatuje r√≥≈ºnicƒô czasu (w milisekundach) na odliczanie HH:MM:SS.
         * @param {number} ms - R√≥≈ºnica czasu w milisekundach.
         * @returns {string} Sformatowane odliczanie.
         */
        function formatujDelteCzasu(ms) {
            let totalSeconds = Math.floor(Math.max(ms, 0) / 1000); // Nie pozwalamy na warto≈õci ujemne
            let hours = Math.floor(totalSeconds / 3600);
            totalSeconds %= 3600;
            let minutes = Math.floor(totalSeconds / 60);
            let seconds = totalSeconds % 60;
            return `${formatujLiczbe(hours)}:${formatujLiczbe(minutes)}:${formatujLiczbe(seconds)}`;
        }

        /**
         * Formatuje d≈Çugo≈õƒá dnia (w milisekundach) na tekst "X godz. Y min.".
         * @param {number} ms - Czas trwania w milisekundach.
         * @returns {string} Sformatowany tekst.
         */
        function formatujDlugoscDnia(ms) {
            let totalMinutes = Math.floor(Math.max(ms, 0) / (1000 * 60));
            let hours = Math.floor(totalMinutes / 60);
            let minutes = totalMinutes % 60;
            return `${hours} godz. ${minutes} min.`;
        }

        /**
         * Sprawdza, czy rok jest przestƒôpny.
         * @param {number} rok - Rok (np. 2024).
         * @returns {boolean} True, je≈õli przestƒôpny.
         */
        function czyRokPrzestepny(rok) {
            return (rok % 4 === 0 && rok % 100 !== 0) || rok % 400 === 0;
        }

        /**
         * Zwraca liczbƒô tygodni w danym roku (52 lub 53).
         * @param {number} rok - Rok (np. 2024).
         * @returns {number} Liczba tygodni.
         */
        function iloscTygodniWRoku(rok) {
            // Sprawdzamy numer tygodnia dla 28 grudnia (zawsze jest w ostatnim tyg. roku)
            return obliczNumerTygodnia(new Date(rok, 11, 28));
        }

        /**
         * Oblicza datƒô Wielkanocy dla danego roku (algorytm Meeus/Jones/Butcher).
         * @param {number} rok - Rok (np. 2024).
         * @returns {Date} Data Niedzieli Wielkanocnej.
         */
        function obliczWielkanoc(rok) {
            const a = rok % 19, b = Math.floor(rok / 100), c = rok % 100, d = Math.floor(b / 4), e = b % 4, f = Math.floor((b + 8) / 25), g = Math.floor((b - f + 1) / 3), h = (19 * a + b - d - g + 15) % 30, i = Math.floor(c / 4), k = c % 4, l = (32 + 2 * e + 2 * i - h - k) % 7, m = Math.floor((a + 11 * h + 22 * l) / 451), miesiac = Math.floor((h + l - 7 * m + 114) / 31), dzien = ((h + l - 7 * m + 114) % 31) + 1;
            return new Date(rok, miesiac - 1, dzien);
        }

        /**
         * Zwraca nowƒÖ datƒô przesuniƒôtƒÖ o zadanƒÖ liczbƒô dni.
         * @param {Date} data - Data bazowa.
         * @param {number} dni - Liczba dni do dodania (mo≈ºe byƒá ujemna).
         * @returns {Date} Nowy obiekt Date.
         */
        function dodajDniDoDaty(data, dni) {
            const nowaData = new Date(data);
            nowaData.setDate(nowaData.getDate() + dni);
            return nowaData;
        }

        /**
         * Formatuje obiekt Date na klucz "MM-DD".
         * POW√ìD: U≈ºywane do szybkiego wyszukiwania w obiektach
         * SWIETA_STALE i IMIENINY_BAZA.
         * @param {Date} data - Obiekt daty.
         * @returns {string} Klucz "MM-DD".
         */
        function formatujDateNaKlucz(data) {
            return `${formatujLiczbe(data.getMonth() + 1)}-${formatujLiczbe(data.getDate())}`;
        }

        /**
         * NOWA FUNKCJA: Konwertuje stopnie dziesiƒôtne na DMS (Stopnie, Minuty, Sekundy).
         * @param {number} dec - Warto≈õƒá dziesiƒôtna (np. 51.6567).
         * @param {boolean} isLng - Czy to d≈Çugo≈õƒá geograficzna (true=E/W, false=N/S).
         * @returns {string} Sformatowany tekst DMS.
         */
        function decToDMS(dec, isLng) {
            let deg = Math.abs(dec);
            let d = Math.floor(deg);
            let min = (deg - d) * 60;
            let m = Math.floor(min);
            let sec = (min - m) * 60;
            let s = Math.round(sec);
            // Obs≈Çuga zaokrƒÖglania (np. 59.9s -> 60s)
            if (s === 60) { m++; s = 0; }
            if (m === 60) { d++; m = 0; }

            let dir;
            if (isLng) {
                dir = dec >= 0 ? 'E' : 'W';
            } else {
                dir = dec >= 0 ? 'N' : 'S';
            }
            return `${d}¬∞ ${formatujLiczbe(m)}‚Ä≤ ${formatujLiczbe(s)}‚Ä≥ ${dir}`;
        }

        /**
         * Pobiera informacje o znaku zodiaku dla danej daty.
         * @param {Date} data - Obiekt daty.
         * @returns {object} Obiekt z 'nazwa' i 'emoji'.
         */
        function pobierzInfoZodiaku(data) {
            const dzien = data.getDate(), miesiac = data.getMonth() + 1;
            // Znajd≈∫ ostatni znak, kt√≥rego data rozpoczƒôcia ju≈º minƒô≈Ça
            let biezacyZnak = ZNAKI_ZODIAKU.find(znak => { return miesiac > znak.start[0] || (miesiac === znak.start[0] && dzien >= znak.start[1]); });
            // Obs≈Çuga "zawijania" roku (Kozioro≈ºec)
            if (!biezacyZnak) { return ZNAKI_ZODIAKU[0]; } // Domy≈õlnie Kozioro≈ºec
            return biezacyZnak;
        }

        /**
         * Mapuje fazƒô ksiƒô≈ºyca (liczba 0.0-1.0) na 8-stopniowƒÖ skalƒô.
         * @param {number} f - Faza z SunCalc (0.0 = n√≥w, 0.5 = pe≈Çnia).
         * @returns {object} Obiekt z 'nazwa', 'emoji' i 'index' (1-8).
         */
        function pobierzInfoKsiezyca(f) {
            if (f <= 0.03 || f > 0.97) return { nazwa: 'N√≥w', emoji: 'üåë', index: 1 };
            if (f <= 0.22) return { nazwa: 'Sierp przybywajƒÖcy', emoji: 'üåí', index: 2 };
            if (f <= 0.28) return { nazwa: 'Pierwsza Kwadra', emoji: 'üåì', index: 3 };
            if (f <= 0.47) return { nazwa: 'Garbaty przybywajƒÖcy', emoji: 'üåî', index: 4 };
            if (f <= 0.53) return { nazwa: 'Pe≈Çnia', emoji: 'üåï', index: 5 };
            if (f <= 0.72) return { nazwa: 'Garbaty ubywajƒÖcy', emoji: 'üåñ', index: 6 };
            if (f <= 0.78) return { nazwa: 'Ostatnia Kwadra', emoji: 'üåó', index: 7 };
            return { nazwa: 'Sierp ubywajƒÖcy', emoji: 'üåò', index: 8 };
        }

        /**
         * Oblicza, za ile dni nastƒÖpi zmiana znaku zodiaku.
         * @param {Date} teraz - Aktualna data.
         * @returns {object} Obiekt z 'nazwa' (nastƒôpnego znaku) i 'dni'.
         */
        function obliczNastepnyZnak(teraz) {
            const infoZodiaku = pobierzInfoZodiaku(teraz);
            const obecnyIndex = ZNAKI_ZODIAKU.findIndex(z => z.nazwa === infoZodiaku.nazwa);
            const nastepnyIndex = (obecnyIndex + 1) % ZNAKI_ZODIAKU.length;
            const nastepnyZnak = ZNAKI_ZODIAKU[nastepnyIndex];

            const rok = teraz.getFullYear();
            let dataStartu = new Date(rok, nastepnyZnak.start[0] - 1, nastepnyZnak.start[1]);

            // Je≈õli data startu nastƒôpnego znaku ju≈º by≈Ça w tym roku, ustaw na przysz≈Çy rok
            if (dataStartu < teraz) {
                dataStartu.setFullYear(rok + 1);
            }

            const diffMs = dataStartu.getTime() - teraz.getTime();
            const diffDni = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
            return { nazwa: nastepnyZnak.nazwa, dni: diffDni };
        }

        /**
         * Oblicza, za ile dni bƒôdzie nastƒôpna pe≈Çnia ksiƒô≈ºyca.
         * POW√ìD: Robi to przez "skanowanie" przysz≈Ço≈õci godzina po godzinie,
         * a≈º faza ksiƒô≈ºyca przekroczy pr√≥g 0.5 (z < 0.5 na >= 0.5).
         * @param {Date} teraz - Aktualna data.
         * @returns {number|string} Liczba dni lub "b/d".
         */
        function obliczNastepnaPelnie(teraz) {
            if (typeof SunCalc === 'undefined') return 'b/d';

            let fazaPoprzednia = SunCalc.getMoonIllumination(teraz).phase;
            let dataPetli = new Date(teraz.getTime());

            // Skanuj nastƒôpne 30 dni (720 godzin)
            for (let i = 0; i < 720; i++) {
                dataPetli.setHours(dataPetli.getHours() + 1); // Przesu≈Ñ o 1 godzinƒô
                let fazaNowa = SunCalc.getMoonIllumination(dataPetli).phase;

                // Sprawd≈∫, czy faza "przeskoczy≈Ça" przez 0.5
                if (fazaPoprzednia < 0.5 && fazaNowa >= 0.5) {
                    const diffMs = dataPetli.getTime() - teraz.getTime();
                    const diffDni = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
                    return diffDni;
                }
                fazaPoprzednia = fazaNowa;
            }
            return 'b/d'; // Nie znaleziono w ciƒÖgu 30 dni (b≈ÇƒÖd?)
        }

        /**
         * NOWA FUNKCJA: Oblicza, za ile dni bƒôdzie nastƒôpna g≈Ç√≥wna faza ksiƒô≈ºyca.
         * (N√≥w, I Kwadra, Pe≈Çnia, III Kwadra).
         * @param {Date} teraz - Aktualna data.
         * @returns {number|string} Liczba dni lub "b/d".
         */
        function obliczNastepnaGlownaFaze(teraz) {
            if (typeof SunCalc === 'undefined') return 'b/d';

            let fazaPoprzednia = SunCalc.getMoonIllumination(teraz).phase;
            
            // Fazy SunCalc: 0.0 (N√≥w), 0.25 (I Kwadra), 0.5 (Pe≈Çnia), 0.75 (III Kwadra), 1.0 (N√≥w)
            let celFazy;
            if (fazaPoprzednia < 0.25) {
                celFazy = 0.25; // Cel: I Kwadra
            } else if (fazaPoprzednia < 0.5) {
                celFazy = 0.5; // Cel: Pe≈Çnia
            } else if (fazaPoprzednia < 0.75) {
                celFazy = 0.75; // Cel: III Kwadra
            } else {
                celFazy = 1.0; // Cel: N√≥w (przej≈õcie przez 1.0)
            }

            let dataPetli = new Date(teraz.getTime());

            // Skanuj nastƒôpne 10 dni (240 godzin) - to bezpieczny zapas na 1 kwadrƒô (ok. 7.4 dnia)
            for (let i = 0; i < 240; i++) {
                dataPetli.setHours(dataPetli.getHours() + 1); // Przesu≈Ñ o 1 godzinƒô
                let fazaNowa = SunCalc.getMoonIllumination(dataPetli).phase;

                let znaleziono = false;
                
                // Sprawdzenie "przej≈õcia" przez cel
                if (celFazy === 1.0) {
                    // Specjalny przypadek dla Nowiu (przej≈õcie z >0.75 na <0.25)
                    if (fazaPoprzednia > 0.75 && fazaNowa < 0.25) {
                        znaleziono = true;
                    }
                } else {
                    // Normalne kwadry
                    if (fazaPoprzednia < celFazy && fazaNowa >= celFazy) {
                        znaleziono = true;
                    }
                }

                if (znaleziono) {
                    // Precyzyjne cofniƒôcie do momentu tu≈º przed przej≈õciem
                    dataPetli.setHours(dataPetli.getHours() - 1); 
                    const diffMs = dataPetli.getTime() - teraz.getTime();
                    const diffDni = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
                    return diffDni === 0 ? 1 : diffDni; // Zawsze zwracaj co najmniej 1 dzie≈Ñ
                }
                
                fazaPoprzednia = fazaNowa;
            }
            return 'b/d'; // Nie znaleziono
        }


        /**
         * ZMIANA: Mapuje kod pogody z Open-Meteo na emoji i polski opis.
         * @param {number} code - Kod pogody (weather_code).
         * @returns {object} Obiekt { ikona, opis }.
         */
        function mapujKodPogody(code) {
            // Kody sƒÖ oparte na dokumentacji Open-Meteo (WMO Weather interpretation codes)
            if (code === 0) return { ikona: '‚òÄÔ∏è', opis: 'Bezchmurnie' };
            if (code === 1) return { ikona: 'üå§Ô∏è', opis: 'G≈Ç√≥wnie bezchmurnie' };
            if (code === 2) return { ikona: 'üå•Ô∏è', opis: 'Czƒô≈õciowe zachmurzenie' };
            if (code === 3) return { ikona: '‚òÅÔ∏è', opis: 'Zachmurzenie' };
            if (code >= 45 && code <= 48) return { ikona: 'üå´Ô∏è', opis: 'Mg≈Ça' };
            if (code >= 51 && code <= 55) return { ikona: 'üå¶Ô∏è', opis: 'M≈ºawka' };
            if (code >= 56 && code <= 57) return { ikona: 'ü•∂', opis: 'MarznƒÖca m≈ºawka' };
            if (code >= 61 && code <= 65) return { ikona: 'üåßÔ∏è', opis: 'Deszcz' };
            if (code >= 66 && code <= 67) return { ikona: 'ü•∂', opis: 'MarznƒÖcy deszcz' };
            if (code >= 71 && code <= 75) return { ikona: '‚ùÑÔ∏è', opis: '≈önieg' };
            if (code === 77) return { ikona: 'üå®Ô∏è', opis: 'Ziarna ≈õnie≈ºne' };
            if (code >= 80 && code <= 82) return { ikona: 'üåßÔ∏è', opis: 'Przelotne opady deszczu' };
            if (code >= 85 && code <= 86) return { ikona: 'üå®Ô∏è', opis: 'Przelotne opady ≈õniegu' };
            if (code >= 95 && code <= 99) return { ikona: '‚õàÔ∏è', opis: 'Burza' };
            return { ikona: '‚ùì', opis: 'Nieznana' }; // Domy≈õlna warto≈õƒá
        }

        // ================================================================
        // --- G≈Å√ìWNE FUNKCJE APLIKACJI ---
        // ================================================================
        
        /**
         * NOWA FUNKCJA: Wy≈õwietla wsp√≥≈Çrzƒôdne w panelu (format DMS).
         */
        function wyswietlWspolrzedne() {
            // U≈ºyj nowych funkcji do konwersji
            const latDMS = decToDMS(BIEZACA_LAT, false);
            const lonDMS = decToDMS(BIEZACA_LON, true);
            const wspolrzedneEl = document.getElementById('wspolrzedne-tekst');
            if (wspolrzedneEl) {
                wspolrzedneEl.textContent = `${latDMS}, ${lonDMS}`;
            }
        }

        /**
         * ZMIANA: Pobiera i aktualizuje pogodƒô z API Open-Meteo.
         * Uruchamiana asynchronicznie (async), aby nie blokowaƒá reszty aplikacji.
         * U≈ºywa teraz globalnych zmiennych BIEZACA_LAT i BIEZACA_LON.
         */
        async function aktualizujPogode() {
            // U≈ºywamy ZMIENNYCH globalnych, kt√≥re mog≈Çy byƒá nadpisane przez geolokalizacjƒô
            const lat = BIEZACA_LAT;
            const lon = BIEZACA_LON;
            
            // Adres URL do API Open-Meteo, proszƒÖcy o aktualnƒÖ temperaturƒô i kod pogody
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&temperature_unit=celsius`;
            
            // Pobranie referencji (wska≈∫nik√≥w) do element√≥w HTML
            const ikonaEl = document.getElementById('pogoda-ikona');
            const infoEl = document.getElementById('pogoda-info');

            try {
                // U≈ºywamy 'fetch' (pobierz) do wys≈Çania ≈ºƒÖdania (request) do API
                // 'await' (czekaj) oznacza, ≈ºe funkcja zatrzyma siƒô tutaj,
                // a≈º otrzyma odpowied≈∫ (response) z serwera.
                const response = await fetch(url);

                if (!response.ok) { // Sprawdzenie, czy serwer odpowiedzia≈Ç poprawnie (np. b≈ÇƒÖd 404, 500)
                    throw new Error(`B≈ÇƒÖd sieci: ${response.statusText}`);
                }
                
                // 'await' (czekaj) na przetworzenie odpowiedzi jako obiekt JSON
                const data = await response.json();

                // Sprawdzenie, czy dane sƒÖ kompletne
                if (data && data.current && data.current.temperature_2m !== undefined) {
                    const temp = data.current.temperature_2m;
                    const code = data.current.weather_code;
                    
                    // Mapowanie kodu (np. 3) na czytelne dane (np. {ikona: '‚òÅÔ∏è', opis: 'Zachmurzenie'})
                    const pogoda = mapujKodPogody(code);
                    
                    // Aktualizacja interfejsu u≈ºytkownika (HTML)
                    ikonaEl.textContent = pogoda.ikona;
                    // U≈ºywamy Math.round() do zaokrƒÖglenia temperatury do najbli≈ºszej liczby ca≈Çkowitej
                    infoEl.textContent = `${Math.round(temp)}¬∞C, ${pogoda.opis}`;
                } else {
                    throw new Error('Nieprawid≈Çowa odpowied≈∫ z API pogody');
                }
            } catch (error) {
                // Obs≈Çuga b≈Çƒôdu (np. brak po≈ÇƒÖczenia z internetem, b≈ÇƒÖd serwera API)
                console.error('B≈ÇƒÖd pobierania pogody:', error);
                ikonaEl.textContent = 'üì°'; // Ikona b≈Çƒôdu
                infoEl.textContent = 'B≈ÇƒÖd pogody';
            }
        }

        /**
         * ZMIANA: Pobiera nazwƒô lokalizacji na podstawie wsp√≥≈Çrzƒôdnych.
         * U≈ºywa darmowego API Open-Meteo Geocoding.
         */
        async function aktualizujNazweLokalizacji() {
            const lat = BIEZACA_LAT;
            const lon = BIEZACA_LON;
            const url = `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=pl`;
            
            // ZMIANA: Celujemy w nowy element span dla samej nazwy
            const nazwaEl = document.getElementById('lokalizacja-nazwa');

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('B≈ÇƒÖd sieci geocoding');
                
                const data = await response.json();
                
                // Pr√≥ba inteligentnego z≈Ço≈ºenia nazwy
                // Np. "Warszawa, Mazowieckie" lub "Berlin, Niemcy"
                if (data && data.name) {
                    let nazwa = data.name; // Np. Warszawa
                    if (data.admin1) { // Np. Mazowieckie
                        nazwa += `, ${data.admin1}`;
                    } else if (data.country) { // Fallback na kraj, je≈õli nie ma regionu
                        nazwa += `, ${data.country}`;
                    }
                    BIEZACA_LOKALIZACJA_NAZWA = nazwa;
                }
                // Je≈õli API zawiedzie, BIEZACA_LOKALIZACJA_NAZWA zachowa domy≈õlnƒÖ warto≈õƒá

            } catch (error) {
                console.error('B≈ÇƒÖd pobierania nazwy lokalizacji:', error);
                // B≈ÇƒÖd nie jest krytyczny, wiƒôc po prostu u≈ºyjemy domy≈õlnej nazwy
                // (lub tej, kt√≥ra ju≈º by≈Ça ustawiona, np. Pabianice)
            }
            
            // Wy≈õwietl nazwƒô (albo pobranƒÖ, albo domy≈õlnƒÖ)
            nazwaEl.textContent = BIEZACA_LOKALIZACJA_NAZWA;
        }

        /**
         * Aktualizuje wszystkie dane, kt√≥re zmieniajƒÖ siƒô raz dziennie.
         * POW√ìD: Jest to "ciƒô≈ºka" funkcja (obliczenia, SunCalc), wiƒôc
         * uruchamiamy jƒÖ only raz, zaraz po p√≥≈Çnocy (wykrywane w
         * 'aktualizujZegar') oraz przy pierwszym uruchomieniu aplikacji.
         * ZMIANA: U≈ºywa teraz globalnych zmiennych BIEZACA_LAT i BIEZACA_LON.
         * @param {Date} teraz - Aktualna data.
         */
        function aktualizujDaneCodzienne(teraz) {
            console.log(`AKTUALIZACJA DANYCH CODZIENNYCH (Lat: ${BIEZACA_LAT}, Lon: ${BIEZACA_LON}) o ${teraz}`);
            const rok = teraz.getFullYear();
            
            // --- Sekcja S≈Ço≈Ñca (SunCalc) ---
            let sunCalcDostepny = typeof SunCalc !== 'undefined';
            if (sunCalcDostepny) {
                const jutro = new Date(teraz);
                jutro.setDate(teraz.getDate() + 1);

                // ZMIANA: U≈ºycie globalnych zmiennych BIEZACA_LAT, BIEZACA_LON
                const daneDzis = SunCalc.getTimes(teraz, BIEZACA_LAT, BIEZACA_LON);
                const daneJutro = SunCalc.getTimes(jutro, BIEZACA_LAT, BIEZACA_LON);

                // Zapisz w globalnym cache
                window.wschodDzis = daneDzis.sunrise;
                window.zachodDzis = daneDzis.sunset;
                window.wschodJutro = daneJutro.sunrise;
                window.zachodJutro = daneJutro.sunset; // NOWE: Zapisujemy te≈º jutrzejszy zach√≥d

                // Oblicz d≈Çugo≈õƒá dnia (only je≈õli mamy obie daty)
                if (window.wschodDzis && window.zachodDzis) {
                    const poprawnaDlugoscDniaMs = window.zachodDzis.getTime() - window.wschodDzis.getTime();
                    document.getElementById('czas-dnia').textContent = formatujDlugoscDnia(poprawnaDlugoscDniaMs);
                } else {
                    document.getElementById('czas-dnia').textContent = "b/d";
                }
                
                // POPRAWKA: Usuniƒôto stƒÖd aktualizacjƒô 'wschod' i 'zachod'.
                // Zosta≈Ça przeniesiona do aktualizujZegar(), aby by≈Ça dynamiczna.

            } else {
                // Obs≈Çuga b≈Çƒôdu, je≈õli SunCalc siƒô nie za≈Çadowa≈Ç
                document.getElementById('wschod').textContent = "b/d";
                document.getElementById('zachod').textContent = "b/d";
                document.getElementById('czas-dnia').textContent = "b/d";
            }

            // --- Sekcja Info Roczne ---
            const dzienRoku = obliczDzienRoku(teraz);
            const maxDniWRoku = czyRokPrzestepny(rok) ? 366 : 365;
            const dniDoKonca = maxDniWRoku - dzienRoku;
            const kwartal = obliczKwartal(teraz);

            document.getElementById('dzien-roku').textContent = dzienRoku;
            document.getElementById('max-dzien-roku').textContent = maxDniWRoku;
            document.getElementById('dni-do-konca').textContent = dniDoKonca;
            document.getElementById('tydzien-roku').textContent = obliczNumerTygodnia(teraz);
            document.getElementById('max-tydzien-roku').textContent = iloscTygodniWRoku(rok);
            document.getElementById('kwartal').textContent = kwartal;

            // --- Sekcja Nag≈Ç√≥wka (≈öwiƒôta, Imieniny) ---
            const dzisKlucz = formatujDateNaKlucz(teraz); // "MM-DD"
            const wszystkieSwieta = [];

            // 1. Sprawd≈∫ ≈õwiƒôta sta≈Çe
            const swietoStale = SWIETA_STALE[dzisKlucz];
            if (swietoStale) wszystkieSwieta.push(swietoStale);

            // 2. Sprawd≈∫ ≈õwiƒôta ruchome (obliczaj only raz na rok)
            if (!window.swietaRuchomeCache[rok]) {
                // Je≈õli cache dla tego roku jest pusty, oblicz Wielkanoc i pochodne
                const wielkanoc = obliczWielkanoc(rok);
                const ponWielkanocny = dodajDniDoDaty(wielkanoc, 1);
                const zieloneSwiatki = dodajDniDoDaty(wielkanoc, 49);
                const bozeCialo = dodajDniDoDaty(wielkanoc, 60);

                // Zapisz obliczone daty w cache
                window.swietaRuchomeCache[rok] = {};
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(wielkanoc)] = 'Niedziela Wielkanocna';
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(ponWielkanocny)] = 'Poniedzia≈Çek Wielkanocny';
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(zieloneSwiatki)] = 'Zielone ≈öwiƒÖtki';
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(bozeCialo)] = 'Bo≈ºe Cia≈Ço';
            }
            // Odczytaj z cache (nawet je≈õli by≈Ç przed chwilƒÖ tworzony)
            const swietoRuchome = window.swietaRuchomeCache[rok][dzisKlucz];
            if (swietoRuchome) wszystkieSwieta.push(swietoRuchome);

            // 3. Sprawd≈∫ ≈õwiƒôta nietypowe (z pliku swieta.js)
            if(typeof SWIETA_NIETYPOWE_BAZA !== 'undefined') {
                const swietoNietypowe = SWIETA_NIETYPOWE_BAZA[dzisKlucz];
                if (swietoNietypowe) wszystkieSwieta.push(swietoNietypowe);
            }
            
            // ZMIANA: Aktualizacja nowych p√≥l dla ≈õwiƒÖt i imienin
            document.getElementById('swieto-nowe').textContent =
                wszystkieSwieta.length ? `(${wszystkieSwieta.join(', ')})` : "(brak)";

            // 4. Pobierz imieniny (z pliku imieniny.js)
            let imieniny = "b/d";
            if (typeof IMIENINY_BAZA !== 'undefined') {
                imieniny = IMIENINY_BAZA[dzisKlucz] || "brak";
            }
            document.getElementById('imiona-nowe').textContent = imieniny;

            // --- Sekcja Astro ---
            const infoZodiaku = pobierzInfoZodiaku(teraz);
            document.getElementById('zodiak-nazwa').textContent = infoZodiaku.nazwa;
            document.getElementById('zodiak-obraz').textContent = infoZodiaku.emoji;

            if (sunCalcDostepny) {
                const moonInfo = SunCalc.getMoonIllumination(teraz);
                const infoKsiezyca = pobierzInfoKsiezyca(moonInfo.phase);
                document.getElementById('faza-ksiezyca-nazwa').textContent = infoKsiezyca.nazwa;
                document.getElementById('faza-ksiezyca-obraz').textContent = infoKsiezyca.emoji;
                document.getElementById('faza-ksiezyca-numer').textContent = infoKsiezyca.index;
            } else {
                document.getElementById('faza-ksiezyca-nazwa').textContent = "b/d";
                document.getElementById('faza-ksiezyca-obraz').textContent = "üõ∞Ô∏è";
                document.getElementById('faza-ksiezyca-numer').textContent = "?";
            }

            // --- Sekcja Odliczania Astro (Tabela) ---
            const infoNastepnegoZnaku = obliczNastepnyZnak(teraz);
            document.getElementById('zodiak-countdown-nazwa').textContent = infoNastepnegoZnaku.nazwa;
            document.getElementById('zodiak-countdown-dni').textContent = infoNastepnegoZnaku.dni;

            const dniDoPelni = obliczNastepnaPelnie(teraz);
            document.getElementById('pelnia-countdown-dni').textContent = dniDoPelni;
            
            // NOWE: Obliczanie i wstawianie nastƒôpnej fazy
            const dniDoFazy = obliczNastepnaGlownaFaze(teraz);
            document.getElementById('faza-countdown-dni').textContent = dniDoFazy;

            // ZMIANA: Uruchomienie od≈õwie≈ºenia pogody i nazwy lokalizacji
            // Robimy to w tym miejscu, aby mieƒá pewno≈õƒá, ≈ºe wsp√≥≈Çrzƒôdne sƒÖ ustawione
            // i ≈ºe od≈õwie≈ºymy dane przy zmianie dnia.
            aktualizujNazweLokalizacji(); // Pobierz nazwƒô dla (nowych lub starych) koordynat√≥w
            aktualizujPogode(); // Pobierz pogodƒô dla (nowych lub starych) koordynat√≥w
        }

        /**
         * G≈Ç√≥wna funkcja "tykajƒÖca" zegara.
         * POW√ìD: Uruchamia siƒô co sekundƒô (przez setInterval).
         * Odpowiada za aktualizacjƒô zegara segmentowego, mruganie
         * dwukropk√≥w i odliczanie do wschodu/zachodu s≈Ço≈Ñca.
         */
        function aktualizujZegar() {
            const teraz = new Date();
            const dzienNumer = teraz.getDate(); // Pobierz numer dnia (1-31)

            /*
                KLUCZOWA LOGIKA (MAGIC): Sprawdzenie zmiany dnia.
                POW√ìD: Je≈õli aktualny numer dnia (np. 16) jest inny ni≈º
                zapisany w globalnej zmiennej 'window.ostatniDzien' (np. 15),
                oznacza to, ≈ºe minƒô≈Ça p√≥≈Çnoc. Uruchamiamy wtedy "ciƒô≈ºkƒÖ"
                funkcjƒô 'aktualizujDaneCodzienne' i aktualizujemy
                zmiennƒÖ globalnƒÖ.
            */
            if (dzienNumer !== window.ostatniDzien) {
                aktualizujDaneCodzienne(teraz); // Ta funkcja pobierze te≈º nowƒÖ pogodƒô
                window.ostatniDzien = dzienNumer;
            }

            // --- Aktualizacje co sekundƒô ---

            // Dzie≈Ñ tygodnia (lekka aktualizacja, mo≈ºe byƒá co sekundƒô)
            const nazwaDnia = DNI_TYGODNIA[teraz.getDay()];
            document.getElementById('dzien').textContent = nazwaDnia;

            // Podzia≈Ç daty i czasu na pojedyncje cyfry
            const godzina = formatujLiczbe(teraz.getHours());
            const minuta = formatujLiczbe(teraz.getMinutes());
            const sekunda = formatujLiczbe(teraz.getSeconds());
            const dzien = formatujLiczbe(teraz.getDate());
            const miesiac = formatujLiczbe(teraz.getMonth() + 1);
            const rok = String(teraz.getFullYear());

            // Aktualizacja wy≈õwietlacza segmentowego
            ustawCyfre('data-d1', dzien[0]);
            ustawCyfre('data-d2', dzien[1]);
            ustawCyfre('data-m1', miesiac[0]);
            ustawCyfre('data-m2', miesiac[1]);
            ustawCyfre('data-r1', rok[0]);
            ustawCyfre('data-r2', rok[1]);
            ustawCyfre('data-r3', rok[2]);
            ustawCyfre('data-r4', rok[3]);

            ustawCyfre('czas-h1', godzina[0]);
            ustawCyfre('czas-h2', godzina[1]);
            ustawCyfre('czas-m1', minuta[0]);
            ustawCyfre('czas-m2', minuta[1]);
            ustawCyfre('czas-s1', sekunda[0]);
            ustawCyfre('czas-s2', sekunda[1]);

            // Logika mrugania dwukropk√≥w (wygaszone w parzystych sekundach)
            const sekundaParzysta = teraz.getSeconds() % 2 === 0;
            document.querySelectorAll('.mrugajacy').forEach(el => {
                el.classList.toggle('wygaszony', sekundaParzysta);
            });

            // --- POPRAWKA: Dynamiczna logika odliczania i wy≈õwietlania czasu S≈Ço≈Ñca ---
            let celCzasu, celTekst;
            const wschodEl = document.getElementById('wschod');
            const zachodEl = document.getElementById('zachod');
            // ZMIANA: Pobranie element√≥w podrzƒôdnych
            const odliczanieIkonaEl = document.getElementById('odliczanie-ikona');
            const odliczanieTekstEl = document.getElementById('odliczanie-tekst');


            // Zabezpieczenie: Je≈õli dane z SunCalc (z cache) jeszcze nie istniejƒÖ...
            // ZMIANA: Sprawdzamy te≈º 'zachodJutro'.
            if (!window.wschodDzis || !window.zachodDzis || !window.wschodJutro || !window.zachodJutro) {
                // ZMIANA: Aktualizacja tylko elementu tekstowego
                odliczanieTekstEl.textContent = (typeof SunCalc === 'undefined') ? "Brak SunCalc..." : "Inicjalizacja...";
                return; // Przerwij dalsze odliczanie
            }
            
            // ZMIANA: Ustawienie ikony (tylko raz, je≈õli jest pusta)
            if (odliczanieIkonaEl.textContent === '') {
                odliczanieIkonaEl.textContent = '‚åõ';
            }

            // Ustal, do czego odliczamy ORAZ co wy≈õwietlamy
            if (teraz < window.wschodDzis) {
                // 1. Przed wschodem: odliczaj do wschodu DZIS
                celCzasu = window.wschodDzis;
                celTekst = "Wsch√≥d s≈Ço≈Ñca za:";
                // Wy≈õwietl czasy na DZIS
                wschodEl.textContent = formatujGodzine(window.wschodDzis);
                zachodEl.textContent = formatujGodzine(window.zachodDzis);

            } else if (teraz < window.zachodDzis) {
                // 2. W trakcie dnia: odliczaj do zachodu DZIS
                celCzasu = window.zachodDzis; // POPRAWKA: By≈Ç b≈ÇƒÖd, tu ma byƒá 'zachodDzis'
                celTekst = "Zach√≥d s≈Ço≈Ñca za:";
                // Wy≈õwietl czasy na DZIS
                wschodEl.textContent = formatujGodzine(window.wschodDzis);
                zachodEl.textContent = formatujGodzine(window.zachodDzis);

            } else {
                // 3. Po zachodzie: odliczaj do wschodu JUTRO
                celCzasu = window.wschodJutro;
                celTekst = "Wsch√≥d s≈Ço≈Ñca za:";
                // KLUCZOWA ZMIANA: Wy≈õwietl czasy na JUTRO
                wschodEl.textContent = formatujGodzine(window.wschodJutro);
                zachodEl.textContent = formatujGodzine(window.zachodJutro);
            }

            // Wykonaj odliczanie (tylko je≈õli cel jest poprawnƒÖ datƒÖ)
            if (celCzasu && typeof celCzasu.getTime === 'function') {
                const deltaMs = celCzasu.getTime() - teraz.getTime();
                // ZMIANA: Aktualizacja tylko elementu tekstowego
                odliczanieTekstEl.textContent = `${celTekst} ${formatujDelteCzasu(deltaMs)}`;
            } else {
                 // ZMIANA: Aktualizacja tylko elementu tekstowego
                 odliczanieTekstEl.textContent = "B≈ÇƒÖd czasu s≈Ço≈Ñca...";
            }
        }

        // ================================================================
        // --- SEKCJA URUCHOMIENIOWA (INITIALIZATION) ---
        // ================================================================

        // 1. Zbuduj dynamicznie strukturƒô HTML zegara
        inicjalizujZegar();

        /*
            ZMIANA: Logika startowa zosta≈Ça opakowana w nowƒÖ funkcjƒô,
            aby mo≈ºna jƒÖ by≈Ço wywo≈Çaƒá PO uzyskaniu geolokalizacji.
        */
        function uruchomAplikacje() {
            console.log("Uruchamianie aplikacji...");
            /*
                2. Uruchom zegar z lekkim op√≥≈∫nieniem.
                POW√ìD: 'setTimeout' o 100ms daje przeglƒÖdarce "chwilƒô oddechu"
                na wyrenderowanie interfejsu (HTML/CSS) przed uruchomieniem
                pƒôtli JavaScript. Dziƒôki temu start aplikacji wydaje siƒô p≈Çynniejszy.
            */
            setTimeout(() => {
                // 3. Wywo≈Çaj pierwszy "tick" zegara (kt√≥ry wywo≈Ça te≈º 'aktualizujDaneCodzienne')
                // 'aktualizujDaneCodzienne' uruchomi te≈º pobieranie pogody i nazwy lokalizacji.
                aktualizujZegar();

                // 4. Ustaw g≈Ç√≥wnƒÖ pƒôtlƒô (interval), kt√≥ra bƒôdzie siƒô wykonywaƒá co sekundƒô
                setInterval(aktualizujZegar, 1000);
            }, 100); // Uruchom po 100 milisekundach
            
            // 5. Ustaw interwa≈Ç (interval) dla pogody (co 15 minut)
            // 15 minut * 60 sekund * 1000 milisekund = 900000
            // ZMIANA: Przeniesione z 'aktualizujDaneCodzienne', aby nie dublowaƒá interwa≈Ç√≥w
            setInterval(aktualizujPogode, 15 * 60 * 1000);
        }

        /*
            NOWA SEKCJA: ZarzƒÖdzanie GeolokalizacjƒÖ
            POW√ìD: Musimy najpierw zapytaƒá o lokalizacjƒô, a dopiero
            potem uruchomiƒá resztƒô aplikacji z w≈Ça≈õciwymi wsp√≥≈Çrzƒôdnymi.
        */
        function pobierzLokalizacje() {
            // ZMIANA: Pobranie elementu ikony
            const ikonaEl = document.getElementById('lokalizacja-ikona');
            const wspolrzedneIkonaEl = document.getElementById('wspolrzedne-ikona');
            
            // Sprawdzenie, czy przeglƒÖdarka w og√≥le wspiera API Geolokalizacji
            if ("geolocation" in navigator) {
                console.log("PrzeglƒÖdarka wspiera geolokalizacjƒô. Pytanie o zgodƒô...");
                // Pro≈õba o lokalizacjƒô. 
                // Sukces: wywo≈Çaj 'geoSukces'
                // B≈ÇƒÖd/Odmowa: wywo≈Çaj 'geoBlad'
                navigator.geolocation.getCurrentPosition(geoSukces, geoBlad);
            } else {
                // PrzeglƒÖdarka nie wspiera geolokalizacji
                console.warn("Geolokalizacja nie jest wspierana. U≈ºywam domy≈õlnych (Pabianice).");
                // ZMIANA: Ustawienie ikony domy≈õlnej/nieaktywnej
                ikonaEl.textContent = 'üõ∞Ô∏è';
                wspolrzedneIkonaEl.textContent = '‚ùå'; // NOWE
                // NOWE: Wy≈õwietl domy≈õlne wsp√≥≈Çrzƒôdne
                wyswietlWspolrzedne();
                // Uruchom aplikacjƒô natychmiast, u≈ºywajƒÖc domy≈õlnych warto≈õci (Pabianice)
                uruchomAplikacje();
            }
        }

        // Ta funkcja wywo≈Ça siƒô, gdy u≈ºytkownik ZGODZI SIƒò na udostƒôpnienie lokalizacji
        function geoSukces(pozycja) {
            console.log("Geolokalizacja uzyskana pomy≈õlnie:", pozycja);
            // ZMIANA: Ustawienie ikony aktywnej
            document.getElementById('lokalizacja-ikona').textContent = 'üìç';
            document.getElementById('wspolrzedne-ikona').textContent = 'üß≠'; // NOWE
            
            // Nadpisujemy domy≈õlne, globalne zmienne
            BIEZACA_LAT = pozycja.coords.latitude;
            BIEZACA_LON = pozycja.coords.longitude;
            
            // NOWE: Wy≈õwietl aktywne wsp√≥≈Çrzƒôdne
            wyswietlWspolrzedne();
            
            // Uruchamiamy aplikacjƒô (teraz bƒôdzie u≈ºywaƒá nowych wsp√≥≈Çrzƒôdnych)
            uruchomAplikacje();
        }

        // Ta funkcja wywo≈Ça siƒô, gdy u≈ºytkownik ODM√ìWI lub wystƒÖpi b≈ÇƒÖd
        function geoBlad(blad) {
            console.warn(`B≈ÇƒÖd geolokalizacji (kod ${blad.code}): ${blad.message}. U≈ºywam domy≈õlnych (Pabianice).`);
            // ZMIANA: Ustawienie ikony domy≈õlnej/nieaktywnej
            document.getElementById('lokalizacja-ikona').textContent = 'üõ∞Ô∏è';
            document.getElementById('wspolrzedne-ikona').textContent = '‚ùå'; // NOWE
            
            // NOWE: Wy≈õwietl domy≈õlne wsp√≥≈Çrzƒôdne
            wyswietlWspolrzedne();
            
            // Niezale≈ºnie od b≈Çƒôdu (odmowa, brak sygna≈Çu),
            // uruchamiamy aplikacjƒô w trybie domy≈õlnym (Pabianice)
            uruchomAplikacje();
        }

        // --- START APLIKACJI ---
        // Zamiast wywo≈Çywaƒá 'uruchomAplikacje()' bezpo≈õrednio,
        // najpierw wywo≈Çujemy funkcjƒô proszƒÖcƒÖ o lokalizacjƒô.
        pobierzLokalizacje();


        // ================================================================
        // --- REJESTRACJA SERVICE WORKERA (PWA) ---
        // ================================================================
        /*
            POW√ìD: Ten kod jest niezbƒôdny, aby aplikacja mog≈Ça dzia≈Çaƒá
            w trybie offline (jako PWA).
            1. Sprawdza, czy przeglƒÖdarka wspiera 'serviceWorker'.
            2. Je≈õli tak, po za≈Çadowaniu strony ('load') pr√≥buje
               zarejestrowaƒá plik 'sw.js'.
            3. Plik 'sw.js' (osobny) musi zawieraƒá logikƒô przechwytywania
               plik√≥w (caching) i serwowania ich z pamiƒôci podrƒôcznej,
               gdy nie ma internetu.
        */
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                /*
                   --- POPRAWKA BUGU #3 (GitHub Pages) ---
                   Usuniƒôto wiodƒÖcy uko≈õnik ('/sw.js') na rzecz ≈õcie≈ºki
                   wzglƒôdnej ('sw.js'), aby poprawnie dzia≈Ça≈Ço na
                   hostingu typu GitHub Pages.
                */
                navigator.serviceWorker.register('sw.js') 
                    .then(registration => {
                        console.log('Service Worker zarejestrowany pomy≈õlnie:', registration);
                    })
                    .catch(error => {
                        console.log('Rejestracja Service Workera nie powiod≈Ça siƒô:', error);
                    });
            });
        }
    </script>

</body>
</html>
