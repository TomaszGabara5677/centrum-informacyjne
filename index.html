<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    
    <script src="suncalc.min.js"></script>

    <title>Kompletne Centrum Informacyjne</title>
    
    <style>
        /* Ca≈Ça sekcja CSS pozostaje bez zmian - jest identyczna 
          jak w Twoim pliku Zegar19seg.html 
        */
        :root {
            --kolor-aktywny: #00FF00;
            --kolor-tla: #1a1a1a;
            --kolor-ramki: #000;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: var(--kolor-tla);
            font-family: 'Courier New', Courier, monospace;
            color: var(--kolor-aktywny);
            padding: 20px;
            box-sizing: border-box; 
        }
        #kontener {
            width: auto;
            max-width: 1000px; 
            padding: 20px 30px;
            border: 4px solid var(--kolor-aktywny);
            border-radius: 10px;
            background-color: var(--kolor-ramki);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        /* ... reszta styl√≥w CSS (identyczna jak w Twoim pliku) ... */
        #tabela-naglowek { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        #tabela-naglowek td { padding: 5px; border: none; vertical-align: middle; }
        .komorka-dzien { font-size: 3.5rem; text-transform: uppercase; letter-spacing: 3px; text-shadow: 0 0 5px var(--kolor-aktywny); width: 40%; text-align: center; vertical-align: middle; }
        .komorka-info { font-size: 1.1rem; text-align: left; padding-left: 15px; border-left: 1px dotted #008000; padding-bottom: 5px; padding-top: 5px; }
        .komorka-swieto { color: #ffff00; min-height: 1.4rem; line-height: 1.5; }
        .komorka-imieniny { color: #00c000; line-height: 1.4; }
        .komorka-imieniny span { color: var(--kolor-aktywny); }
        #tabela-info-roczne { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 1.1rem; color: #00c000; }
        #tabela-info-roczne td { width: 50%; padding: 3px 0; border: none; vertical-align: top; }
        #tabela-info-roczne .max { color: #008000; }
        #tabela-info-roczne span span { color: var(--kolor-aktywny); font-weight: bold; }
        #tabela-info-roczne td:nth-child(1) { text-align: right; padding-right: 10px; }
        #tabela-info-roczne td:nth-child(2) { text-align: left; padding-left: 10px; border-left: 1px dotted #008000; }
        #zegar-segmentowy-kontener { display: flex; flex-direction: column; align-items: center; margin-bottom: 10px; width: 100%; overflow-x: auto; }
        .kontener-linii { display: flex; align-items: center; justify-content: center; flex-wrap: nowrap; white-space: nowrap; }
        .cyfra { position: relative; width: 30px; height: 50px; margin: 0 2px; flex-shrink: 0; }
        .segment { position: absolute; background-color: var(--kolor-aktywny); opacity: 0.1; transition: opacity 0.2s; border-radius: 2px; box-shadow: 0 0 5px var(--kolor-aktywny); }
        .segment.active { opacity: 1; }
        .segment.a, .segment.d, .segment.g { width: 20px; height: 4px; left: 5px; }
        .segment.b, .segment.c, .segment.e, .segment.f { width: 4px; height: 20px; }
        .segment.a { top: 0; }
        .segment.d { top: 46px; }
        .segment.g { top: 23px; }
        .segment.b { top: 5px; left: 26px; }
        .segment.c { top: 25px; left: 26px; }
        .segment.f { top: 5px; left: 0; }
        .segment.e { top: 25px; left: 0; }
        .separator { height: 50px; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; flex-shrink: 0; }
        .separator-dwukropek { width: 20px; }
        .separator-dwukropek::before, .separator-dwukropek::after { content: ''; display: block; width: 4px; height: 4px; background-color: var(--kolor-aktywny); border-radius: 50%; box-shadow: 0 0 5px var(--kolor-aktywny); transition: opacity 0.1s; }
        .separator-dwukropek::before { margin-bottom: 8px; margin-top: 8px; }
        .separator-dwukropek.wygaszony::before, .separator-dwukropek.wygaszony::after { opacity: 0.1; }
        .separator-kreska { width: 30px; display: flex; justify-content: center; align-items: center; }
        .separator-kreska::before { content: ''; display: block; width: 20px; height: 4px; background-color: var(--kolor-aktywny); box-shadow: 0 0 5px var(--kolor-aktywny); border-radius: 2px; }
        .separator-spacer { width: 25px; height: 50px; flex-shrink: 0; }
        #tabela-slonce { width: auto; border-collapse: collapse; }
        #tabela-slonce td { padding: 4px 8px; border: none; text-align: left; font-size: 1.3rem; color: #00c000; vertical-align: top; }
        #tabela-slonce span { font-weight: bold; color: var(--kolor-aktywny); }
        #tabela-slonce #odliczanie-slonca { font-size: 1.3rem; color: #ffff00; text-shadow: 0 0 5px #ffff00; font-weight: normal; }
        #astro { font-size: 1.3rem; color: #00c000; width: 100%; display: flex; justify-content: center; align-items: center; flex-wrap: wrap; margin-top: 10px; }
        #astro span { color: var(--kolor-aktywny); }
        .astro-item { display: flex; align-items: center; margin: 5px 0; }
        .zodiak-emoji { font-size: 2.5rem; margin-right: 10px; text-shadow: none; width: 40px; text-align: center; }
        #faza-ksiezyca-obraz { font-size: 2.5rem; margin-right: 10px; text-shadow: none; width: 40px; text-align: center; }
        .astro-separator { margin: 0 15px; font-size: 2rem; color: #008000; }
        #astro-countdown { font-size: 1.1rem; color: #008000; width: 100%; display: flex; justify-content: center; align-items: center; flex-wrap: wrap; }
        #astro-countdown > span { color: #008000; margin: 3px 0; }
        #astro-countdown span span { color: var(--kolor-aktywny); font-weight: bold; }
        .astro-separator-maly { margin: 0 10px; font-size: 1.1rem; color: #008000; }

        /* --- SEKCJA RESPONSYWNA DLA TELEFONU W POZIOMIE --- 
         
         KOMENTARZ (DLACZEGO?): Poni≈ºszy blok @media to "magiczna" regu≈Ça,
         kt√≥ra aktywuje zawarte w niej style CSS tylko wtedy, gdy
         urzƒÖdzenie jest w orientacji poziomej (landscape) ORAZ
         jego wysoko≈õƒá jest mniejsza ni≈º 500 pikseli.
         
         To pozwala nam precyzyjnie namierzyƒá telefony trzymane bokiem,
         ignorujƒÖc jednocze≈õnie tablety i monitory komputerowe.
        */
        @media (orientation: landscape) and (max-height: 500px) {
            
            /* KOMENTARZ (DLACZEGO?): W trybie pe≈Çnoekranowym nie chcemy ≈ºadnych
             margines√≥w ani paddingu na samym 'body'. 
             Usuwamy 'padding: 20px', kt√≥ry by≈Ç zdefiniowany w g≈Ç√≥wnych
             stylach, aby nasz kontener m√≥g≈Ç dotykaƒá krawƒôdzi ekranu.
            */
            body {
                padding: 0;
            }
            
            /* KOMENTARZ (DLACZEGO?): To jest g≈Ç√≥wna regu≈Ça. 
             RozciƒÖgamy kontener na 100% szeroko≈õci i wysoko≈õci ekranu.
            */
            #kontener {
                /* Ustawia szeroko≈õƒá na 100% szeroko≈õci okna przeglƒÖdarki */
                width: 100vw; 
                /* Ustawia wysoko≈õƒá na 100% wysoko≈õci okna przeglƒÖdarki */
                height: 100vh;
                
                /* Usuwa limit 'max-width: 1000px', kt√≥ry przeszkadza≈Çby
                   na szerszych telefonach. */
                max-width: none;
                
                /* Usuwa zaokrƒÖglone rogi, kt√≥re wyglƒÖda≈Çyby ≈∫le
                   przy krawƒôdziach ekranu. */
                border-radius: 0;
                
                /* KOMENTARZ (DLACZEGO?): To jest kluczowa "magiczna" w≈Ça≈õciwo≈õƒá.
                 M√≥wi ona przeglƒÖdarce, aby 'border' (4px) i 'padding' (10px)
                 zosta≈Çy wliczone DO WEWNƒÑTRZ wymiar√≥w 100vw/100vh, 
                 zamiast dodawane na zewnƒÖtrz. Bez tego kontener
                 by≈Çby za du≈ºy i pojawi≈Çyby siƒô paski przewijania.
                */
                box-sizing: border-box;
                
                /* Zmniejszamy wewnƒôtrzne odstƒôpy (padding), aby zmie≈õciƒá
                   wiƒôcej tre≈õci na bardzo niskim ekranie. */
                padding: 10px 15px;
                
                /* Pozwala na przewijanie zawarto≈õci w pionie, je≈õli
                   tre≈õƒá mimo wszystko siƒô nie zmie≈õci (np. na bardzo
                   ma≈Çym telefonie). */
                overflow-y: auto;
            }
            
            /* --- ZMNIEJSZENIE CZCIONEK I ELEMENT√ìW --- */
            
            /* KOMENTARZ (DLACZEGO?): Ekran w poziomie jest bardzo niski,
             wiƒôc musimy drastycznie zmniejszyƒá czcionki, aby
             zapobiec "rozpychaniu" uk≈Çadu.
            */
            
            /* Zmniejszamy du≈ºy napis z dniem tygodnia */
            .komorka-dzien {
                font-size: 2.5rem; /* By≈Ço 3.5rem */
                letter-spacing: 2px;
                width: 35%; /* Dajemy trochƒô mniej miejsca */
            }
            
            /* Zmniejszamy napisy "Imieniny:", "(≈öwiƒôto...)" */
            .komorka-info {
                font-size: 0.95rem; /* By≈Ço 1.1rem */
                line-height: 1.3;
                padding-left: 10px;
            }

            /* Zmniejszamy napisy "Dzie≈Ñ roku:", "Tydzie≈Ñ:" itd. */
            #tabela-info-roczne {
                font-size: 0.95rem; /* By≈Ço 1.1rem */
                margin-bottom: 5px;
            }
            
            /* KOMENTARZ (DLACZEGO?): Zegar segmentowy jest za du≈ºy.
             U≈ºywamy 'transform: scale()' aby go proporcjonalnie
             zmniejszyƒá do 80% oryginalnego rozmiaru.
            */
            .cyfra, .separator {
                transform: scale(0.8);
                /* Korekta margines√≥w po skalowaniu, by cyfry
                   by≈Çy bli≈ºej siebie */
                margin: 0 -3px;
            }

            /* Zmniejszamy te≈º pustƒÖ przestrze≈Ñ miƒôdzy datƒÖ a godzinƒÖ */
            .separator-spacer {
                width: 15px; /* By≈Ço 25px */
            }
            
            /* Zmniejszamy odstƒôp pod zegarem */
            #zegar-segmentowy-kontener {
                margin-bottom: 5px;
            }

            /* Zmniejszamy czcionki dla sekcji S≈Ço≈Ñca */
            #tabela-slonce, #tabela-slonce #odliczanie-slonca {
                font-size: 1.0rem; /* By≈Ço 1.3rem */
            }
            #tabela-slonce td {
                padding: 2px 5px;
            }
            
            /* Zmniejszamy sekcjƒô Astro (Zodiak, Ksiƒô≈ºyc) */
            #astro {
                font-size: 1.0rem; /* By≈Ço 1.3rem */
                margin-top: 5px;
            }
            .zodiak-emoji, #faza-ksiezyca-obraz {
                font-size: 2.0rem; /* By≈Ço 2.5rem */
                margin-right: 5px;
            }
            
            /* Zmniejszamy dolne odliczanie */
            #astro-countdown {
                font-size: 0.9rem; /* By≈Ço 1.1rem */
                /* Ukrywamy separator na bardzo wƒÖskich ekranach */
                flex-direction: column; 
            }
            .astro-separator-maly {
                display: none; /* Ukrywamy | miƒôdzy odliczaniem */
            }
        }
        /* --- SEKCJA BLOKADY ORIENTACJI --- */

        /* KOMENTARZ (DLACZEGO?): Domy≈õlnie ukrywamy komunikat
          o obr√≥cenie telefonu.
        */
        #obroc-urzadzenie {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--kolor-ramki);
            color: var(--kolor-aktywny);
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 1.5rem;
        }
        #obroc-urzadzenie .ikona {
            font-size: 5rem;
            margin-bottom: 20px;
            /* Prosta animacja obrotu */
            animation: obrot-ikony 2s linear infinite;
        }
        
        @keyframes obrot-ikony {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* KOMENTARZ (DLACZEGO?): To jest "magiczna" regu≈Ça blokujƒÖca.
          Aktywuje siƒô, gdy urzƒÖdzenie jest w orientacji pionowej.
        */
        @media (orientation: portrait) {
            /* 1. Ukrywamy g≈Ç√≥wnƒÖ tre≈õƒá aplikacji */
            #kontener {
                display: none;
            }
            
            /* 2. Pokazujemy (jako flex) nasz komunikat blokady */
            #obroc-urzadzenie {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <div id="obroc-urzadzenie">
        <div class="ikona">üì±üîÑ</div>
        <p>Proszƒô obr√≥ciƒá urzƒÖdzenie do pozycji poziomej.</p>
    </div>

    <div id="kontener">
        <table id="tabela-naglowek">
            <tr>
                <td class="komorka-dzien" rowspan="2">
                    <span id="dzien">...</span>
                </td>
                <td class="komorka-info komorka-swieto">
                    <span id="swieto">...</span>
                </td>
            </tr>
            <tr>
                <td class="komorka-info komorka-imieniny">
                    Imieniny: <span id="imiona">...</span>
                </td>
            </tr>
        </table>

        <table id="tabela-info-roczne">
            <tr>
                <td>
                    Dzie≈Ñ roku: <span><span id="dzien-roku">...</span><span class="max">/<span id="max-dzien-roku">...</span></span></span>
                </td>
                <td>
                    Tydzie≈Ñ: <span><span id="tydzien-roku">...</span><span class="max">/<span id="max-tydzien-roku">...</span></span></span>
                </td>
            </tr>
            <tr>
                <td>
                    Sylwester za: <span><span id="dni-do-konca">...</span></span> dni
                </td>
                <td>
                    Kwarta≈Ç: <span><span id="kwartal">...</span><span class="max">/4</span></span>
                </td>
            </tr>
        </table>
        
        <div id="zegar-segmentowy-kontener"></div>
        
        
        <table id="tabela-slonce">
            <tr>
                <td>
                    ‚òÄÔ∏è Wsch√≥d: <span id="wschod">...</span>
                </td>
                <td>
                    D≈Çugo≈õƒá dnia: <span id="czas-dnia">...</span>
                </td>
            </tr>
            <tr>
                <td>
                    üåô Zach√≥d: <span id="zachod">...</span>
                </td>
                <td id="odliczanie-slonca">
                    ≈Åadowanie...
                </td>
            </tr>
        </table>

        <div id="astro">
            <div class="astro-item">
                <span id="zodiak-obraz" class="zodiak-emoji">...</span>
                <span>Znak: <span id="zodiak-nazwa">...</span></span>
            </div>
            <span class="astro-separator">|</span>
            <div class="astro-item">
                <span id="faza-ksiezyca-obraz">...</span>
                <span>
                    Faza (<span id="faza-ksiezyca-numer">...</span>/8): 
                    <span id="faza-ksiezyca-nazwa">...</span>
                </span>
            </div>
        </div>
        
        <div id="astro-countdown" class="astro-countdown">
            <span>
                Zmiana zodiaku na: <span id="zodiak-countdown-nazwa">...</span> 
                za: <span id="zodiak-countdown-dni">...</span> dni
            </span>
            <span class="astro-separator-maly">|</span>
            <span>
                Pe≈Çnia ksiƒô≈ºyca za: <span id="pelnia-countdown-dni">...</span> dni
            </span>
        </div>
    </div>

    <script src="imieniny.js"></script>
    <script src="swieta.js"></script>

    <script>
        /* Ca≈Çy g≈Ç√≥wny skrypt JS pozostaje bez zmian - jest identyczny 
          jak w Twoim pliku Zegar19seg.html 
        */
        
        // --- SEKCJA KONFIGURACYJNA I STA≈ÅE ---
        const DNI_TYGODNIA = ['Niedziela', 'Poniedzia≈Çek', 'Wtorek', '≈öroda', 'Czwartek', 'PiƒÖtek', 'Sobota'];
        const PABIANICE_LAT = 51.6567;
        const PABIANICE_LON = 19.3578;
        const SWIETA_STALE = {
            '01-01': 'Nowy Rok', '01-06': 'Trzech Kr√≥li', '05-01': '≈öwiƒôto Pracy',
            '05-03': '≈öwiƒôto Konstyt. 3 Maja', '08-15': '≈öwiƒôto Wojska Polskiego, Wniebowziƒôcie NMP',
            '11-01': 'Wszystkich ≈öwiƒôtych', '11-11': 'Narodowe ≈öwiƒôto Niepodleg≈Ço≈õci',
            '12-25': 'Bo≈ºe Narodzenie (I dzie≈Ñ)', '12-26': 'Bo≈ºe Narodzenie (II dzie≈Ñ)'
        };
        const ZNAKI_ZODIAKU = [
            { nazwa: 'Kozioro≈ºec', start: [12, 22], emoji: '‚ôë' },
            { nazwa: 'Wodnik', start: [1, 20], emoji: '‚ôí' },
            { nazwa: 'Ryby', start: [2, 19], emoji: '‚ôì' },
            { nazwa: 'Baran', start: [3, 21], emoji: '‚ôà' },
            { nazwa: 'Byk', start: [4, 20], emoji: '‚ôâ' },
            { nazwa: 'Bli≈∫niƒôta', start: [5, 21], emoji: '‚ôä' },
            { nazwa: 'Rak', start: [6, 21], emoji: '‚ôã' },
            { nazwa: 'Lew', start: [7, 23], emoji: '‚ôå' },
            { nazwa: 'Panna', start: [8, 23], emoji: '‚ôç' },
            { nazwa: 'Waga', start: [9, 23], emoji: '‚ôé' },
            { nazwa: 'Skorpion', start: [10, 23], emoji: '‚ôè' },
            { nazwa: 'Strzelec', start: [11, 22], emoji: '‚ôê' }
        ];
        const MAPA_SEGMENTOW = {
            '0': ['a', 'b', 'c', 'd', 'e', 'f'],
            '1': ['b', 'c'],
            '2': ['a', 'b', 'g', 'e', 'd'],
            '3': ['a', 'b', 'g', 'c', 'd'],
            '4': ['f', 'g', 'b', 'c'],
            '5': ['a', 'f', 'g', 'c', 'd'],
            '6': ['a', 'f', 'g', 'e', 'c', 'd'],
            '7': ['a', 'b', 'c'],
            '8': ['a', 'b', 'c', 'd', 'e', 'f', 'g'],
            '9': ['a', 'b', 'c', 'd', 'f', 'g'],
            ' ': []
        };
        const STRUKTURA_DATY = [
            { typ: 'cyfra', id: 'data-d1' }, { typ: 'cyfra', id: 'data-d2' },
            { typ: 'separator', 'rodzaj': 'kreska' },
            { typ: 'cyfra', id: 'data-m1' }, { typ: 'cyfra', id: 'data-m2' },
            { typ: 'separator', 'rodzaj': 'kreska' },
            { typ: 'cyfra', id: 'data-r1' }, { typ: 'cyfra', id: 'data-r2' },
            { typ: 'cyfra', id: 'data-r3' }, { typ: 'cyfra', id: 'data-r4' }
        ];
        const STRUKTURA_CZASU = [
            { typ: 'cyfra', id: 'czas-h1' }, { typ: 'cyfra', id: 'czas-h2' },
            { typ: 'separator', 'rodzaj': 'dwukropek' },
            { typ: 'cyfra', id: 'czas-m1' }, { typ: 'cyfra', id: 'czas-m2' },
            { typ: 'separator', 'rodzaj': 'dwukropek' },
            { typ: 'cyfra', id: 'czas-s1' }, { typ: 'cyfra', id: 'czas-s2' }
        ];
        
        // --- ZMIENNE GLOBALNE (CACHE) ---
        window.ostatniDzien = null; 
        window.wschodDzis = null;
        window.zachodDzis = null;
        window.wschodJutro = null;
        window.swietaRuchomeCache = {};

        // --- FUNKCJE POMOCNICZE ---
        /* ... ca≈Çy (d≈Çugi) blok funkcji pomocniczych ... */
        function stworzCyfre(id) {
            const cyfraDiv = document.createElement('div');
            cyfraDiv.classList.add('cyfra');
            cyfraDiv.id = id;
            const segmenty = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
            segmenty.forEach(seg => {
                const segmentDiv = document.createElement('div');
                segmentDiv.classList.add('segment', seg);
                cyfraDiv.appendChild(segmentDiv);
            });
            return cyfraDiv;
        }
        function stworzSeparator(rodzaj) {
            const separatorDiv = document.createElement('div');
            separatorDiv.classList.add('separator', `separator-${rodzaj}`);
            if (rodzaj === 'dwukropek') {
                separatorDiv.classList.add('mrugajacy');
            }
            return separatorDiv;
        }
        function inicjalizujZegar() {
            const kontenerGlowny = document.getElementById('zegar-segmentowy-kontener');
            if (!kontenerGlowny) return;
            const kontenerLinii = document.createElement('div');
            kontenerLinii.classList.add('kontener-linii');
            STRUKTURA_DATY.forEach(el => {
                if (el.typ === 'cyfra') {
                    kontenerLinii.appendChild(stworzCyfre(el.id));
                } else if (el.typ === 'separator') {
                    kontenerLinii.appendChild(stworzSeparator(el.rodzaj));
                }
            });
            const spacer = document.createElement('div');
            spacer.classList.add('separator-spacer'); 
            kontenerLinii.appendChild(spacer);
            STRUKTURA_CZASU.forEach(el => {
                if (el.typ === 'cyfra') {
                    kontenerLinii.appendChild(stworzCyfre(el.id));
                } else if (el.typ === 'separator') {
                    kontenerLinii.appendChild(stworzSeparator(el.rodzaj));
                }
            });
            kontenerGlowny.appendChild(kontenerLinii);
        }
        function ustawCyfre(elementId, cyfra) {
            const el = document.getElementById(elementId);
            if (!el) return;
            const cyfraStr = String(cyfra); 
            const segmentyDoWlaczenia = MAPA_SEGMENTOW[cyfraStr];
            el.querySelectorAll('.segment').forEach(s => s.classList.remove('active'));
            if (segmentyDoWlaczenia) {
                segmentyDoWlaczenia.forEach(seg => {
                    const segmentElement = el.querySelector(`.segment.${seg}`);
                    if (segmentElement) {
                        segmentElement.classList.add('active');
                    }
                });
            }
        }
        function formatujLiczbe(liczba) { return String(liczba).padStart(2, '0'); }
        function formatujGodzine(data) {
            if (data && typeof data.getHours === 'function') {
                const godzina = formatujLiczbe(data.getHours());
                const minuta = formatujLiczbe(data.getMinutes());
                return `${godzina}:${minuta}`;
            }
            return 'b/d';
        }
        function obliczDzienRoku(data) {
            const startRoku = new Date(data.getFullYear(), 0, 0);
            const diff = data - startRoku;
            const jedenDzienMs = 1000 * 60 * 60 * 24;
            return Math.floor(diff / jedenDzienMs);
        }
        function obliczNumerTygodnia(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            var weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return weekNo;
        }
        function obliczKwartal(data) {
            const miesiac = data.getMonth(); 
            return Math.floor(miesiac / 3) + 1;
        }
        function formatujDelteCzasu(ms) {
            let totalSeconds = Math.floor(Math.max(ms, 0) / 1000);
            let hours = Math.floor(totalSeconds / 3600);
            totalSeconds %= 3600;
            let minutes = Math.floor(totalSeconds / 60);
            let seconds = totalSeconds % 60;
            return `${formatujLiczbe(hours)}:${formatujLiczbe(minutes)}:${formatujLiczbe(seconds)}`;
        }
        function formatujDlugoscDnia(ms) {
            let totalMinutes = Math.floor(Math.max(ms, 0) / (1000 * 60));
            let hours = Math.floor(totalMinutes / 60);
            let minutes = totalMinutes % 60;
            return `${hours} godz. ${minutes} min.`;
        }
        function czyRokPrzestepny(rok) {
            return (rok % 4 === 0 && rok % 100 !== 0) || rok % 400 === 0;
        }
        function iloscTygodniWRoku(rok) {
            return obliczNumerTygodnia(new Date(rok, 11, 28));
        }
        function obliczWielkanoc(rok) {
            const a = rok % 19, b = Math.floor(rok / 100), c = rok % 100, d = Math.floor(b / 4), e = b % 4, f = Math.floor((b + 8) / 25), g = Math.floor((b - f + 1) / 3), h = (19 * a + b - d - g + 15) % 30, i = Math.floor(c / 4), k = c % 4, l = (32 + 2 * e + 2 * i - h - k) % 7, m = Math.floor((a + 11 * h + 22 * l) / 451), miesiac = Math.floor((h + l - 7 * m + 114) / 31), dzien = ((h + l - 7 * m + 114) % 31) + 1;
            return new Date(rok, miesiac - 1, dzien);
        }
        function dodajDniDoDaty(data, dni) {
            const nowaData = new Date(data);
            nowaData.setDate(nowaData.getDate() + dni);
            return nowaData;
        }
        function formatujDateNaKlucz(data) {
            return `${formatujLiczbe(data.getMonth() + 1)}-${formatujLiczbe(data.getDate())}`;
        }
        function pobierzInfoZodiaku(data) {
            const dzien = data.getDate(), miesiac = data.getMonth() + 1;
            let biezacyZnak = ZNAKI_ZODIAKU.find(znak => { return miesiac > znak.start[0] || (miesiac === znak.start[0] && dzien >= znak.start[1]); });
            if (!biezacyZnak) { return ZNAKI_ZODIAKU[0]; }
            return biezacyZnak;
        }
        function pobierzInfoKsiezyca(f) {
            if (f <= 0.03 || f > 0.97) return { nazwa: 'N√≥w', emoji: 'üåë', index: 1 };
            if (f <= 0.22) return { nazwa: 'Sierp przybywajƒÖcy', emoji: 'üåí', index: 2 };
            if (f <= 0.28) return { nazwa: 'Pierwsza Kwadra', emoji: 'üåì', index: 3 };
            if (f <= 0.47) return { nazwa: 'Garbaty przybywajƒÖcy', emoji: 'üåî', index: 4 };
            if (f <= 0.53) return { nazwa: 'Pe≈Çnia', emoji: 'üåï', index: 5 };
            if (f <= 0.72) return { nazwa: 'Garbaty ubywajƒÖcy', emoji: 'üåñ', index: 6 };
            if (f <= 0.78) return { nazwa: 'Ostatnia Kwadra', emoji: 'üåó', index: 7 };
            return { nazwa: 'Sierp ubywajƒÖcy', emoji: 'üåò', index: 8 };
        }
        function obliczNastepnyZnak(teraz) {
            const infoZodiaku = pobierzInfoZodiaku(teraz);
            const obecnyIndex = ZNAKI_ZODIAKU.findIndex(z => z.nazwa === infoZodiaku.nazwa);
            const nastepnyIndex = (obecnyIndex + 1) % ZNAKI_ZODIAKU.length;
            const nastepnyZnak = ZNAKI_ZODIAKU[nastepnyIndex];
            const rok = teraz.getFullYear();
            let dataStartu = new Date(rok, nastepnyZnak.start[0] - 1, nastepnyZnak.start[1]);
            if (dataStartu < teraz) {
                dataStartu.setFullYear(rok + 1);
            }
            const diffMs = dataStartu.getTime() - teraz.getTime();
            const diffDni = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
            return { nazwa: nastepnyZnak.nazwa, dni: diffDni };
        }
        function obliczNastepnaPelnie(teraz) {
            if (typeof SunCalc === 'undefined') return 'b/d';
            let fazaPoprzednia = SunCalc.getMoonIllumination(teraz).phase;
            let dataPetli = new Date(teraz.getTime());
            for (let i = 0; i < 720; i++) {
                dataPetli.setHours(dataPetli.getHours() + 1);
                let fazaNowa = SunCalc.getMoonIllumination(dataPetli).phase;
                if (fazaPoprzednia < 0.5 && fazaNowa >= 0.5) {
                    const diffMs = dataPetli.getTime() - teraz.getTime();
                    const diffDni = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
                    return diffDni;
                }
                fazaPoprzednia = fazaNowa;
            }
            return 'b/d';
        }

        // --- G≈Å√ìWNE FUNKCJE APLIKACJI ---
        /* ... ca≈Çy (d≈Çugi) blok g≈Ç√≥wnych funkcji aplikacji ... */
        function aktualizujDaneCodzienne(teraz) {
            console.log("AKTUALIZACJA DANYCH CODZIENNYCH o " + teraz);
            const rok = teraz.getFullYear();
            let sunCalcDostepny = typeof SunCalc !== 'undefined';
            if (sunCalcDostepny) {
                const jutro = new Date(teraz);
                jutro.setDate(teraz.getDate() + 1);
                const daneDzis = SunCalc.getTimes(teraz, PABIANICE_LAT, PABIANICE_LON);
                const daneJutro = SunCalc.getTimes(jutro, PABIANICE_LAT, PABIANICE_LON);
                window.wschodDzis = daneDzis.sunrise;
                window.zachodDzis = daneDzis.sunset;
                window.wschodJutro = daneJutro.sunrise;
                if (window.wschodDzis && window.zachodDzis) {
                    const poprawnaDlugoscDniaMs = window.zachodDzis.getTime() - window.wschodDzis.getTime();
                    document.getElementById('czas-dnia').textContent = formatujDlugoscDnia(poprawnaDlugoscDniaMs);
                } else {
                    document.getElementById('czas-dnia').textContent = "b/d";
                }
                document.getElementById('wschod').textContent = formatujGodzine(window.wschodDzis);
                document.getElementById('zachod').textContent = formatujGodzine(window.zachodDzis);
            } else {
                document.getElementById('wschod').textContent = "b/d";
                document.getElementById('zachod').textContent = "b/d";
                document.getElementById('czas-dnia').textContent = "b/d";
            }
            const dzienRoku = obliczDzienRoku(teraz);
            const maxDniWRoku = czyRokPrzestepny(rok) ? 366 : 365;
            const dniDoKonca = maxDniWRoku - dzienRoku;
            const kwartal = obliczKwartal(teraz);
            document.getElementById('dzien-roku').textContent = dzienRoku;
            document.getElementById('max-dzien-roku').textContent = maxDniWRoku;
            document.getElementById('dni-do-konca').textContent = dniDoKonca;
            document.getElementById('tydzien-roku').textContent = obliczNumerTygodnia(teraz);
            document.getElementById('max-tydzien-roku').textContent = iloscTygodniWRoku(rok);
            document.getElementById('kwartal').textContent = kwartal;
            const dzisKlucz = formatujDateNaKlucz(teraz);
            const wszystkieSwieta = [];
            const swietoStale = SWIETA_STALE[dzisKlucz];
            if (swietoStale) wszystkieSwieta.push(swietoStale);
            if (!window.swietaRuchomeCache[rok]) {
                const wielkanoc = obliczWielkanoc(rok);
                const ponWielkanocny = dodajDniDoDaty(wielkanoc, 1);
                const zieloneSwiatki = dodajDniDoDaty(wielkanoc, 49);
                const bozeCialo = dodajDniDoDaty(wielkanoc, 60);
                window.swietaRuchomeCache[rok] = {};
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(wielkanoc)] = 'Niedziela Wielkanocna';
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(ponWielkanocny)] = 'Poniedzia≈Çek Wielkanocny';
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(zieloneSwiatki)] = 'Zielone ≈öwiƒÖtki';
                window.swietaRuchomeCache[rok][formatujDateNaKlucz(bozeCialo)] = 'Bo≈ºe Cia≈Ço';
            }
            const swietoRuchome = window.swietaRuchomeCache[rok][dzisKlucz];
            if (swietoRuchome) wszystkieSwieta.push(swietoRuchome);
            if(typeof SWIETA_NIETYPOWE_BAZA !== 'undefined') {
                const swietoNietypowe = SWIETA_NIETYPOWE_BAZA[dzisKlucz];
                if (swietoNietypowe) wszystkieSwieta.push(swietoNietypowe);
            }
            document.getElementById('swieto').textContent = 
                wszystkieSwieta.length ? `(${wszystkieSwieta.join(', ')})` : "";
            let imieniny = "b/d";
            if (typeof IMIENINY_BAZA !== 'undefined') {
                imieniny = IMIENINY_BAZA[dzisKlucz] || "brak";
            }
            document.getElementById('imiona').textContent = imieniny;
            const infoZodiaku = pobierzInfoZodiaku(teraz);
            document.getElementById('zodiak-nazwa').textContent = infoZodiaku.nazwa;
            document.getElementById('zodiak-obraz').textContent = infoZodiaku.emoji;
            if (sunCalcDostepny) {
                const moonInfo = SunCalc.getMoonIllumination(teraz);
                const infoKsiezyca = pobierzInfoKsiezyca(moonInfo.phase);
                document.getElementById('faza-ksiezyca-nazwa').textContent = infoKsiezyca.nazwa;
                document.getElementById('faza-ksiezyca-obraz').textContent = infoKsiezyca.emoji;
                document.getElementById('faza-ksiezyca-numer').textContent = infoKsiezyca.index;
            } else {
                document.getElementById('faza-ksiezyca-nazwa').textContent = "b/d";
                document.getElementById('faza-ksiezyca-obraz').textContent = "üõ∞Ô∏è";
                document.getElementById('faza-ksiezyca-numer').textContent = "?";
            }
            const infoNastepnegoZnaku = obliczNastepnyZnak(teraz);
            document.getElementById('zodiak-countdown-nazwa').textContent = infoNastepnegoZnaku.nazwa;
            document.getElementById('zodiak-countdown-dni').textContent = infoNastepnegoZnaku.dni;
            const dniDoPelni = obliczNastepnaPelnie(teraz);
            document.getElementById('pelnia-countdown-dni').textContent = dniDoPelni;
        }

        function aktualizujZegar() {
            const teraz = new Date();
            const dzienNumer = teraz.getDate();
            if (dzienNumer !== window.ostatniDzien) {
                aktualizujDaneCodzienne(teraz);
                window.ostatniDzien = dzienNumer;
            }
            const nazwaDnia = DNI_TYGODNIA[teraz.getDay()];
            document.getElementById('dzien').textContent = nazwaDnia;
            const godzina = formatujLiczbe(teraz.getHours());
            const minuta = formatujLiczbe(teraz.getMinutes());
            const sekunda = formatujLiczbe(teraz.getSeconds());
            const dzien = formatujLiczbe(teraz.getDate());
            const miesiac = formatujLiczbe(teraz.getMonth() + 1);
            const rok = String(teraz.getFullYear());
            ustawCyfre('data-d1', dzien[0]);
            ustawCyfre('data-d2', dzien[1]);
            ustawCyfre('data-m1', miesiac[0]);
            ustawCyfre('data-m2', miesiac[1]);
            ustawCyfre('data-r1', rok[0]);
            ustawCyfre('data-r2', rok[1]);
            ustawCyfre('data-r3', rok[2]);
            ustawCyfre('data-r4', rok[3]);
            ustawCyfre('czas-h1', godzina[0]);
            ustawCyfre('czas-h2', godzina[1]);
            ustawCyfre('czas-m1', minuta[0]);
            ustawCyfre('czas-m2', minuta[1]);
            ustawCyfre('czas-s1', sekunda[0]);
            ustawCyfre('czas-s2', sekunda[1]);
            const sekundaParzysta = teraz.getSeconds() % 2 === 0;
            document.querySelectorAll('.mrugajacy').forEach(el => {
                el.classList.toggle('wygaszony', sekundaParzysta);
            });
            let celCzasu, celTekst;
            if (!window.wschodDzis || !window.zachodDzis || !window.wschodJutro) {
                document.getElementById('odliczanie-slonca').textContent = (typeof SunCalc === 'undefined') ? "Brak SunCalc..." : "Inicjalizacja...";
                return;
            }
            if (teraz < window.wschodDzis) {
                celCzasu = window.wschodDzis;
                celTekst = "Wsch√≥d s≈Ço≈Ñca za:";
            } else if (teraz < window.zachodDzis) {
                celCzasu = window.zachodDzis;
                celTekst = "Zach√≥d s≈Ço≈Ñca za:";
            } else {
                celCzasu = window.wschodJutro;
                celTekst = "Wsch√≥d s≈Ço≈Ñca za:";
            }
            if (celCzasu && typeof celCzasu.getTime === 'function') {
                const deltaMs = celCzasu.getTime() - teraz.getTime();
                document.getElementById('odliczanie-slonca').textContent = 
                    `${celTekst} ${formatujDelteCzasu(deltaMs)}`;
            } else {
                 document.getElementById('odliczanie-slonca').textContent = "B≈ÇƒÖd czasu s≈Ço≈Ñca...";
            }
        }

        // --- SEKCJA URUCHOMIENIOWA ---
        inicjalizujZegar(); 
        setTimeout(() => {
            aktualizujZegar(); 
            setInterval(aktualizujZegar, 1000); 
        }, 100);

        
        /* KOMENTARZ (DLACZEGO?): Ten blok kodu jest NOWY.
          Jego zadaniem jest zarejestrowanie pliku 'sw.js' (Service Worker).
          
          1. Sprawdza, czy przeglƒÖdarka w og√≥le wspiera Service Workery 
             ('serviceWorker' in navigator).
          2. Je≈õli tak, czeka a≈º strona siƒô za≈Çaduje ('load').
          3. Nastƒôpnie pr√≥buje zarejestrowaƒá plik 'sw.js'.
          4. Je≈õli siƒô uda, wypisuje w konsoli sukces, je≈õli nie - b≈ÇƒÖd.
          
          Ten kod jest kluczowy, by aplikacja mog≈Ça dzia≈Çaƒá offline.
        */
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
              .then(registration => {
                console.log('Service Worker zarejestrowany pomy≈õlnie:', registration);
              })
              .catch(error => {
                console.log('Rejestracja Service Workera nie powiod≈Ça siƒô:', error);
              });
          });
        }
    </script>

</body>
</html>


